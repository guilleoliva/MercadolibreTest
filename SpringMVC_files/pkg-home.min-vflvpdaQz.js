define("modules/clean/react/home/actions",["require","exports","modules/constants/env","modules/core/browser","modules/core/uri","modules/core/i18n","modules/core/notify","modules/clean/flux/dispatcher","modules/clean/react/home/api","modules/clean/react/home/constants","modules/clean/react/home/constants"],function(e,t,n,i,r,o,a,c,s,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(){function e(){}return e.initializeStore=function(e,t,n){c.Dispatcher.dispatch({type:l.HomeActionTypes.INITIALIZE_STORE,payload:{role:e,sectionVisibility:t,sectionToConditionalData:n}})},e.setSectionVisibility=function(e,t,n){var i=t[".tag"];c.Dispatcher.dispatch({type:l.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:i,visible:n}}),s.setSectionVisibility(e,t,n).catch(function(e){var t=n?o._("Unable to show section."):o._("Unable to hide section.");return a.Notify.error(t),c.Dispatcher.dispatch({type:l.HomeActionTypes.SET_SECTION_VISIBILITY,payload:{section:i,visible:!n}}),Promise.reject(e)})},e.createPaperDocInNewTab=function(e){var t=o._("Could not create paper document."),c=window.open("about:blank");s.createPaperDoc(e).then(function(e){if(c&&!c.closed){var o=new r.URI({scheme:"https",authority:n.NOTES_WEBSERVER,path:"/doc/"+e.doc_id}).toString();i.redirect(o,c)}else a.Notify.error(t)}).catch(function(e){if(a.Notify.error(t),c&&!c.closed)return c.close()})},e.createPaperDocFromTemplateInNewTab=function(e){void 0===e&&(e="");var t=window.open("about:blank"),c="";switch(e){case u.PaperTemplateTypes.BRAINSTORM:c="/pad/open-or-create-sample/brainstorm-template";break;case u.PaperTemplateTypes.MEETING_NOTES:c="/pad/open-or-create-sample/meeting-notes-template";break;case u.PaperTemplateTypes.PROJECT_PLAN:c="/pad/open-or-create-sample/project-plan";break;default:return a.Notify.error(o._("Invalid document type")),void(t&&!t.closed&&t.close())}var s=new r.URI({scheme:"https",authority:n.NOTES_WEBSERVER,path:c}).toString();t?i.redirect(s,t):a.Notify.error(o._("Could not create paper document."))},e})();t.HomeActions=d}),define("modules/clean/react/home/api",["require","exports","tslib","modules/clean/ajax","external/lodash","modules/clean/api_v2/client","modules/core/exception","modules/clean/web_timing_logger","modules/clean/react/home/util/experiment_hook"],function(e,t,n,i,r,o,a,c,s){"use strict";var l=this;Object.defineProperty(t,"__esModule",{value:!0}),t.now=function(){return Date.now()};var u=0;t.makeRequest=function(e,t){void 0===t&&(t={});var r=t.delayRequest?~~(90*Math.random())+10:0,o=function(o,c){var l=t.isBackground?i.SilentBackgroundRequest:i.WebRequest,d=(new Date).getTime();l(n.__assign({dataType:"json",success:o,error:function(n,i,o){if("abort"!==i){var l=e&&e.url||"no url",m=o?": '"+o+"'":"";a.reportStack("makeRequest to '"+l+"' failed - "+i+m,{severity:a.SEVERITY.NONCRITICAL,exc_extra:{errorThrown:o,textStatus:i,requestParams:e,requestOptions:t,requestDelay:r,openRequests:u,requestDuration:(new Date).getTime()-d,runningExperiments:s.getRunningExperiments(),status:n.status,"exclog.exc_group":"homeapi:"+i+":"+o+":"+l}}),c(Error(o+" ("+l+")"))}}},e))};return r?new Promise(function(e,t){setTimeout(function(){u++,o(e,t)},r)}).then(function(){u--}).catch(function(e){return u--,Promise.reject(e)}):new Promise(function(e,t){o(e,t)})};var d={},m=r.throttle(function(){r.size(d)>1&&a.reportStack("Multiple role activities",{severity:a.SEVERITY.NONCRITICAL,exc_extra:d}),Object.keys(d).forEach(function(e){var n=d[e];t.makeRequest({url:"/home_feed/log_activities",type:"POST",data:{role:e,activities_json:JSON.stringify(r.map(n,"json")),send_ts:t.now(),page_start_ts:window.performance&&window.performance.timing?window.performance.timing.navigationStart||window.performance.timing.fetchStart:void 0}},{isBackground:!0,delayRequest:!0}).then(function(){return n.forEach(function(e){return e.resolve()})},function(){return n.forEach(function(e){return e.reject()})})}),d={}},1e3,{leading:!0,trailing:!0});t.logHomeActivity=function(e){var i=e.role,o=e.eventName,a=e.extra;return new Promise(function(e,s){return n.__awaiter(l,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return d[i]=d[i]||[],d[i].push({json:{event_name:o,event_time:t.now(),extra:r.mapValues(a||{},function(e){return String(e)})},resolve:e,reject:s}),[4,c.waitForTTI()];case 1:return n.sent(),m(),[2]}})})})},t.setSectionVisibility=function(e,t,n){return(new o.ApiV2Client).ns("home").rpc("set_section_visibility",{section:t,visible:n},{subjectUserId:e})},t.createPaperDoc=function(e){return(new o.ApiV2Client).upload(e,"paper/docs/create",{import_format:"plain_text"},"")}}),define("modules/clean/react/home/constants",["require","exports","modules/clean/react/home/util/experiment_hook"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.experimentOverride=n.experimentOverride;(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.DO_NOT_LOAD=1]="DO_NOT_LOAD",e[e.IMMEDIATE=2]="IMMEDIATE",e[e.POST_TTI=3]="POST_TTI"})(t.ConditionalSectionLoadingPreference||(t.ConditionalSectionLoadingPreference={}));(function(e){e[e.UNKNOWN=0]="UNKNOWN",e[e.SYNCHRONOUS=1]="SYNCHRONOUS",e[e.ASYNCHRONOUS_PRE_TTI=2]="ASYNCHRONOUS_PRE_TTI",e[e.POST_TTI=3]="POST_TTI"})(t.ConditionalSectionLoadingMode||(t.ConditionalSectionLoadingMode={})),t.HomeActionTypes={INITIALIZE_STORE:"HOME_INITIALIZE_STORE",SET_SECTION_VISIBILITY:"HOME_SET_SECTION_VISIBILITY",LOADED_ASYNC_CONDITIONAL_SECTION:"HOME_STORE_LOADED_ASYNC_CONDITIONAL_SECTION",DECLARE_CONDITIONAL_SECTION:"HOME_STORE_DECLARE_CONDITIONAL_SECTION"},t.HomeResourceStoreActionTypes={RECEIVED_RESOURCE_ID_TO_FILE:"HOME_RESOURCE_STORE_RECEIVED_RESOURCE_ID_TO_FILE",REQUEST_PREVIEW:"HOME_RESOURCE_STORE_REQUEST_PREVIEW"},t.HomeSections={UNREAD:"unread",STARRED:"starred",RECENTS:"recents"},t.ConditionalSections={PAPER_RECENTS:"paper_recents"},t.LoggingTypes={CLICK_SHOW_ALL:"click_show_all",HOME_PAGE_SHOWN:"home_page_shown",UNREAD_SHOWN:"unread_shown",STARRED_SHOWN:"starred_shown",RECENTS_SHOWN:"recents_shown",HIDE_SECTION:"hide_section",UNHIDE_SECTION:"unhide_section",RECENTS_ITEM_ACTION:"recents_item_action",OPEN_UNREAD_ITEM:"open_unread_document",MARK_AS_READ:"mark_as_read",OPEN_STARRED_ITEM:"open_starred_item",UNSTAR_ITEM:"unstar_item",UNDO_UNSTAR_ITEM:"undo_unstar_item",CLICK_STAR_OVERFLOW_MENU:"click_star_overflow_menu",CLICK_STAR_OVERFLOW_SHARE:"click_star_overflow_share",CLICK_STAR_OVERFLOW_UPLOAD:"click_star_overflow_upload",CLICK_INCOMING_ACTION:"click_incoming_action",CLICK_RIGHT_NAV_ITEM:"click_right_nav_item",CLICK_INCOMING_SHOW_READ:"click_incoming_show_read",CLICK_RECENT_ITEMS:"click_recent_item",OPEN_INCOMING:"open_incoming",OPEN_INCOMING_DOCUMENT:"open_incoming_document",OPEN_STARRED_DOCUMENT:"open_starred_item",OPEN_DOCUMENT:"open_document",CLICK_UPLOAD_FILES:"upload_files",CLICK_CREATE_PAPER_DOC:"create_paper_doc",CLICK_CREATE_BRAINSTORM_DOC:"create_brainstorm_doc",CLICK_CREATE_MEETING_NOTES_DOC:"create_meeting_notes_doc",CLICK_CREATE_PROJECT_PLAN_DOC:"create_project_plan_doc",CLICK_NEW_SHARED_FOLDER:"new_shared_folder",VIEW_UPLOADED_FILES:"view_uploaded_files"},t.HomePrefetchTypes={RETRIEVE_STARRED:"retrieve_starred",RECENTS_JSON:"recents_json",RETRIEVE_PAPER_RECENTS:"retrieve_paper_recents",RETRIEVE_UNREAD:"retrieve_unread"},t.LoadingStates={LOADING:"LOADING",SUCCESS:"SUCCESS",FAILURE:"FAILURE"},t.FILE_RESOURCE_TYPE="FILE",t.FOLDER_RESOURCE_TYPE="FOLDER",t.PAPER_DOCUMENT_RESOURCE_TYPE="PAPER_DOCUMENT",t.PAPER_FOLDER_RESOURCE_TYPE="PAPER_FOLDER",t.EXTERNAL_RESOURCE_TYPE="EXTERNAL",t.DisplayTypeToResourceType={DOC:t.FILE_RESOURCE_TYPE,MSDOC:t.FILE_RESOURCE_TYPE,PDF:t.FILE_RESOURCE_TYPE,SPREADSHEET:t.FILE_RESOURCE_TYPE,FILE:t.FILE_RESOURCE_TYPE,FOLDER:t.FOLDER_RESOURCE_TYPE,SHARED_FOLDER:t.FOLDER_RESOURCE_TYPE,TEAM_FOLDER:t.FOLDER_RESOURCE_TYPE,PAPER_DOCUMENT:t.PAPER_DOCUMENT_RESOURCE_TYPE,PAPER_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PUBLIC_FOLDER:t.PAPER_FOLDER_RESOURCE_TYPE,PAPER_PROJECT:t.PAPER_FOLDER_RESOURCE_TYPE,EXTERNAL:t.EXTERNAL_RESOURCE_TYPE},t.ExceptionTags={UNREAD:"home_unread"},t.DisplayTypes={AGGREGATION:"AGGREGATION",DOC:"DOC",MSDOC:"DOC",PDF:"PDF",SPREADSHEET:"SPREADSHEET",FILE:"FILE",FOLDER:"FOLDER",SHARED_FOLDER:"SHARED_FOLDER",TEAM_FOLDER:"TEAM_FOLDER",PAPER_DOCUMENT:"PAPER_DOCUMENT",PAPER_FOLDER:"PAPER_FOLDER",PAPER_PUBLIC_FOLDER:"PAPER_PUBLIC_FOLDER",PAPER_PROJECT:"PAPER_PROJECT"},t.DisplayTypeToIconName={AGGREGATION:"image",FOLDER:"folder",SHARED_FOLDER:"folder_shared",TEAM_FOLDER:"folder_team",CDM_TEAM_MEMBER_FOLDER:"folder_team_member",PAPER_DOCUMENT:"paper",PAPER_FOLDER:"folder",PAPER_PUBLIC_FOLDER:"folder_team",PAPER_PROJECT:"folder_project"},t.PaperTemplateTypes={PROJECT_PLAN:"project_plan",MEETING_NOTES:"meeting_notes",BRAINSTORM:"brainstorm"},t.PaperSidebarLinkVariants={OFF:"OFF",CONTROL:"CONTROL",V0:"V0",V1:"V1",V2:"V2"},t.UNREAD_PREFETCH_FALLBACK_LIMIT=16}),define("modules/clean/react/home/experiment_config",["require","exports"],function(e,t){"use strict";function n(){return l}Object.defineProperty(t,"__esModule",{value:!0});var i=[{original:function(){return e(["modules/clean/react/home/starred/starred_view"])},experiment:function(){return e(["modules/clean/react/home/experiments/home_experiment_example/starred/starred_view"])},keys:["StarredView"]}],r=[{original:function(){return e(["modules/clean/react/home/home_access/unread/home_access_unread"])},experiment:function(){return e(["modules/clean/react/home/experiments/home_suggested_files/home_access/unread/home_access_unread"])},keys:["HomeAccessUnread"]},{original:function(){return e(["modules/clean/react/home/home_access/onboarding/tooltips"])},experiment:function(){return e(["modules/clean/react/home/experiments/suggested_shared/home_access/onboarding/tooltips"])},keys:["showUnreadTooltipIfRendered"]}],o=[{original:function(){return e(["modules/clean/react/home/home_access/home_access_main"])},experiment:function(){return e(["modules/clean/react/home/experiments/home_suggest_grid/home_access/home_access_main"])},keys:["HomeAccessMain"]}],a=[{original:function(){return e(["modules/clean/react/home/home_access/unread/home_access_unread"])},experiment:function(){return e(["modules/clean/react/home/experiments/home_suggested_stars/home_access/unread/home_access_unread"])},keys:["HomeAccessUnread"]},{original:function(){return e(["modules/clean/react/home/home_access/onboarding/tooltips"])},experiment:function(){return e(["modules/clean/react/home/experiments/suggested_shared/home_access/onboarding/tooltips"])},keys:["showUnreadTooltipIfRendered"]}],c=[{original:function(){return e(["modules/clean/recent_activity/react/recent_activity_item_view"])},experiment:function(){return e(["modules/clean/react/home/experiments/home_calendar/recent_activity/react/recent_activity_item_view"])},keys:["RecentActivityItemView"]},{original:function(){return e(["modules/clean/react/home/starred/starred_item"])},experiment:function(){return e(["modules/clean/react/home/experiments/home_calendar/starred/starred_item"])},keys:["StarredItem"]}],s=[{original:function(){return e(["modules/clean/react/home/home_access/home_access_main"])},experiment:function(){return e(["modules/clean/react/home/experiments/home_calendar/home_access/home_access_main"])},keys:["HomeAccessMain"]}],l={home_experiment_example:i,home_suggested_files:r,home_suggest_grid:o,home_suggested_stars:a,home_proto_calendar_drag:c,home_proto_calendar:s};t.getExperiments=n}),define("modules/clean/react/home/home_access/home_access_experiment_wrapper",["require","exports","tslib","external/react","modules/clean/react/home/home_access/home_access_web","modules/clean/react/home/util/home_experiment","modules/clean/web_timing_logger"],function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(t){var n=e.call(this,t)||this;return a.log_js_modules_application_code_start(),n}return n.__extends(t,e),t.prototype.spinner=function(){return i.createElement("div",{className:"maestro-loading-spinner-wrapper"},i.createElement("div",{className:"maestro-loading-spinner"}))},t.prototype.render=function(){var e=this.props,t=e.activeExperiments,a=n.__rest(e,["activeExperiments"]);return Object.keys(t).length?i.createElement(o.HomeExperiment,{placeholder:this.spinner(),activeExperiments:t},i.createElement(r.HomeAccessWeb,n.__assign({},a))):i.createElement(r.HomeAccessWeb,n.__assign({},a))},t})(i.Component);t.HomeAccessExperimentWrapper=c}),define("modules/clean/react/home/home_access/home_access_main",["require","exports","tslib","external/react","modules/clean/react/home/constants","modules/clean/react/home/home_access/onboarding/actions","modules/clean/react/home/home_access/recents/section","modules/clean/react/home/util/conditional","modules/clean/react/home/store","modules/clean/user_education/user_education_client","modules/clean/user_education/user_education_interface","modules/clean/react/home/starred/starred_empty_state","modules/clean/react/home/util/experiment_hook"],function(e,t,n,i,r,o,a,c,s,l,u,d,m){"use strict";function _(e){return e&&e.HomeAccessUnread}function p(e){return e&&e.StarredView}Object.defineProperty(t,"__esModule",{value:!0}),t.experimentOverride=m.experimentOverride;var h=c.homeConditionalSection({section:r.HomeSections.UNREAD,syncLoader:function(){return _(e("modules/clean/react/home/home_access/unread/home_access_unread"))},asyncLoader:function(){return new Promise(function(t,n){e(["modules/clean/react/home/home_access/unread/home_access_unread"],t,n)}).then(function(e){return _(e)})}}),E=c.homeConditionalSection({section:r.HomeSections.STARRED,syncLoader:function(){return p(e("modules/clean/react/home/starred/conditional_interface"))},asyncLoader:function(){return new Promise(function(t,n){e(["modules/clean/react/home/starred/conditional_interface"],t,n)}).then(function(e){return p(e)})},loading:i.createElement(d.StarredEmptyStateWithHeader,null)}),f=(function(e){function t(t){var n=e.call(this,t)||this;return n.onHomeStoreUpdate=function(){return n.setState(n.getStateFromStore())},n.state=n.getStateFromStore(),n.removeStoreListeners=s.getHomeStore().addListener(n.onHomeStoreUpdate),n}return n.__extends(t,e),t.prototype.componentWillMount=function(){l.eventEmitter.on(u.UserEducationStateChannel,o.handleHomeUserEducationStateSteps),o.updateShowUnreadOnboarding(this.props.showUnreadOnboarding),this.props.onboardingComplete&&o.markHomeOnboardingComplete()},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.getStateFromStore=function(){var e=s.getHomeStore();return{sectionVisibility:e.getSectionVisibility(),canRenderAllHomeSections:e.canRenderAllHomeSections()}},t.prototype.render=function(){var e=this.state,t=e.canRenderAllHomeSections,n=e.sectionVisibility,o=this.props,c=o.showDismissSuggestModal,s=o.user,l=o.role,u=o.now;return t?i.createElement("main",{className:"home-access",role:"main"},i.createElement("ul",{className:"home-access-sections",ref:"main"},i.createElement("li",{className:"home-access-section"},i.createElement(h,{showDismissSuggestModal:c,now:u})),i.createElement("li",{className:"home-access-section"},i.createElement(E,null)),i.createElement("li",{className:"home-access-section"},i.createElement(a.HomeRecentsSection,{user:s,role:l,now:u,isHiddenByUser:!n[r.HomeSections.RECENTS]})))):null},t.displayName="HomeAccessMain",t.defaultProps={showUnreadOnboarding:!1},t})(i.PureComponent);t.HomeAccessMain=f}),define("modules/clean/react/home/home_access/home_access_web",["require","exports","tslib","external/react","external/react-dom","modules/clean/react/home/actions","modules/clean/react/home/home_access/home_access_main","modules/clean/react/home/home_access/onboarding/store","modules/clean/react/home/home_access/sidebar","modules/clean/react/home/resource/store","modules/clean/react/home/store","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/maestro/header","modules/clean/react/maestro/layout","modules/clean/react/home/post_tti/api","modules/clean/react/home/util/conditional_api","modules/clean/viewer","modules/core/exception","modules/core/i18n","modules/pagelet_config"],function(e,t,n,i,r,o,a,c,s,l,u,d,m,_,p,h,E,f,g,y){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var v=(function(e){function t(n){var i=e.call(this,n)||this;return i.intervalHandle=null,i.markHomeAsRendered=function(){var e=window.ensemble;e&&(e.markPageletRenderedByDOMNode?e.markPageletRenderedByDOMNode(r.findDOMNode(i)):e.markPageletRendered&&e.markPageletRendered(y.REQUIREJS_CONFIG.context))},i.state={now:new Date},t.initializeHomeStores(n.initialRole,n.initialSectionVisibility,n.sectionToConditionalData),i}return n.__extends(t,e),t.initializeHomeStores=function(e,t,n){var i=E.Viewer.get_viewer().get_user_by_role(e);f.assert(!!i,"Could not find user for role "+e),d.homeTimingLogger.activate(),u.getHomeStore(),o.HomeActions.initializeStore(e,t,n),c.getHomeOnboardingStore(),l.getHomeResourceStore(),h.waitForStarred(function(e){return e.getStarredResourceStore()})},t.prototype.renderMain=function(e,t){return i.createElement("div",{className:"home"},i.createElement(a.HomeAccessMain,{now:this.state.now,role:this.props.initialRole,user:e,viewer:t,showUnreadOnboarding:this.props.showUnreadOnboarding,onboardingComplete:this.props.onboardingComplete,calendarProtoData:this.props.calendarProtoData,showDismissSuggestModal:this.props.showDismissSuggestModal}))},t.prototype.renderSidebar=function(e){return i.createElement(s.HomeSidebar,{user:e,isPaperEnabledForUser:this.props.isPaperEnabledForUser,paperLinksVariant:this.props.paperLinksVariant})},t.prototype.componentDidMount=function(){var e=this;d.homeTimingLogger.registerLoadCallback(this.markHomeAsRendered,4e3),p.waitForHomeTTI().then(function(t){e.intervalHandle=setInterval(function(){return e.setState({now:new Date})},6e4),t.homeAccessWebComponentDidMount(e.props.renderSnapEngage)})},t.prototype.componentWillUnmount=function(){null!=this.intervalHandle&&clearInterval(this.intervalHandle)},t.prototype.render=function(){var e=E.Viewer.get_viewer(),t=e.get_user_by_role(this.props.initialRole);if(!t)return null;var n={searchBarExperiments:this.props.searchBarExperiments};return i.createElement(_.MaestroChrome,{user:t,embeddedAppRegion:this.renderMain(t,e),titleRegion:i.createElement(m.MaestroHeaderTitle,null,g._("Home")),actionSidebarRegion:this.renderSidebar(t),searchBarProps:n})},t.displayName="HomeAccessWeb",t})(i.PureComponent);t.HomeAccessWeb=v}),define("modules/clean/react/home/home_access/onboarding/actions",["require","exports","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/onboarding/api","modules/clean/react/home/home_access/onboarding/constants","modules/clean/react/home/home_access/onboarding/store","modules/clean/react/home/home_access/onboarding/tooltips","modules/clean/react/home/util/constants"],function(e,t,n,i,r,o,a,c){"use strict";function s(){n.Dispatcher.dispatch({type:r.HomeOnboardingActionTypes.SET_ONBOARDING_COMPLETE})}function l(){o.getHomeOnboardingStore().shouldShowUnreadOnboarding()&&a.showUnreadTooltipIfRendered()&&(i.hideUnreadOnboarding(),u(!1))}function u(e){n.Dispatcher.dispatch({type:r.HomeOnboardingActionTypes.UPDATE_SHOW_UNREAD_ONBOARDING,showUnreadOnboarding:e})}function d(e){var t=function(e){var t=window;"scrollBehavior"in document.documentElement.style?t.scroll({top:e,left:0,behavior:"smooth"}):t.scroll(0,e)},n=e.step;if(n)if(n.name===c.HOME_V1_USER_EDUCATION_STEP_NAMES.RECENTLY_VIEWED){var i=document.querySelector(".maestro-header"),r=document.querySelector(".home-recents-section"),o=void 0,a=void 0,s=void 0;i&&r&&(o=i.getBoundingClientRect(),a=r.getBoundingClientRect(),s=a.top-(o.height+o.top),t(s))}else n.name===c.HOME_V1_USER_EDUCATION_STEP_NAMES.FILES&&t(0)}Object.defineProperty(t,"__esModule",{value:!0}),t.markHomeOnboardingComplete=s,t.showUnreadOnboardingTooltipIfNecessary=l,t.updateShowUnreadOnboarding=u,t.handleHomeUserEducationStateSteps=d}),define("modules/clean/react/home/home_access/onboarding/api",["require","exports","modules/clean/react/home/store","modules/clean/react/home/api"],function(e,t,n,i){"use strict";function r(){return i.makeRequest({url:"/home_feed/hide_unread_onboarding",type:"POST",data:{role:n.getHomeStore().getRole()}})}Object.defineProperty(t,"__esModule",{value:!0}),t.hideUnreadOnboarding=r}),define("modules/clean/react/home/home_access/onboarding/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HomeOnboardingActionTypes={SET_ONBOARDING_COMPLETE:"HOME_ONBOARDING_SET_ONBOARDING_COMPLETE",UPDATE_SHOW_UNREAD_ONBOARDING:"HOME_ONBOARDING_UPDATE_SHOW_UNREAD_ONBOARDING"}}),define("modules/clean/react/home/home_access/onboarding/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/home_access/onboarding/constants","modules/clean/flux/flux_store"],function(e,t,n,i,r,o){"use strict";function a(){return null===s&&(s=new c),s}Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){var t=e.call(this,i.Dispatcher)||this;return t.isOnboardingComplete=!1,t.showUnreadOnboarding=!1,t}return n.__extends(t,e),t.prototype.getIsOnboardingComplete=function(){return this.isOnboardingComplete},t.prototype.shouldShowUnreadOnboarding=function(){return this.showUnreadOnboarding&&this.getIsOnboardingComplete()},t.prototype.onUpdateShowUnreadOnboarding=function(e){this.showUnreadOnboarding=e},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case r.HomeOnboardingActionTypes.SET_ONBOARDING_COMPLETE:this.isOnboardingComplete=!0;break;case r.HomeOnboardingActionTypes.UPDATE_SHOW_UNREAD_ONBOARDING:this.onUpdateShowUnreadOnboarding(t.showUnreadOnboarding);break;default:return}this.__emitChange()},t})(o.FluxStore);t.HomeOnboardingStoreClass=c;var s=null;t.getHomeOnboardingStore=a}),define("modules/clean/react/home/home_access/onboarding/tooltips",["require","exports","modules/core/i18n","modules/clean/react/home/util/static_tooltip","modules/clean/react/home/util/experiment_hook"],function(e,t,n,i,r){"use strict";function o(e,t,n,r,o){var a=document.querySelector(e);return!!a&&((new i.StaticTooltip).show(t,n,a,r,c,c,o),!0)}function a(){return o(".home__unread-row--first .unread-item__title-group",n._("Tip"),n._("New shared files and comments show up here."),i.StaticTooltip.POSITIONS.RIGHT,"home-tooltip__unread-onboarding--list")}Object.defineProperty(t,"__esModule",{value:!0}),t.experimentOverride=r.experimentOverride;var c=function(){return null};t.showUnreadTooltipIfRendered=a}),define("modules/clean/react/home/home_access/recents/section",["require","exports","tslib","external/react","modules/clean/react/home/actions","modules/clean/react/home/constants","modules/clean/recent_activity/react/recent_activity_container","modules/clean/react/home/section_header","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/logging/activity_logger","modules/core/i18n"],function(e,t,n,i,r,o,a,c,s,l,u){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var d=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onChangeRecentsVisibility=function(){var e=!t.props.isHiddenByUser;r.HomeActions.setSectionVisibility(t.props.user.id,{".tag":"recents"},!e),l.homeActivityLogger.logShowHideSection(o.HomeSections.RECENTS,e)},t.renderHiddenText=function(){return i.createElement("div",{className:"home-access__recents-hidden-text"},u._("Your recently viewed files are hidden")," · ",i.createElement("button",{className:"button-as-link",onClick:t.onChangeRecentsVisibility},u._("Show")))},t}return n.__extends(t,e),t.prototype.componentDidMount=function(){this.props.isHiddenByUser&&s.homeTimingLogger.logEmptySection(o.HomeSections.RECENTS)},t.prototype.render=function(){var e=null,t="home-recents-section__container",r=null;return this.props.isHiddenByUser?(e=u._("Show"),t="home-recents-section__container-hidden",r=this.renderHiddenText()):e=u._("Hide"),i.createElement("span",{className:"home-recents-section"},i.createElement(c.SectionHeader,{title:u._("Recent"),ueName:"recents",buttonText:e,buttonAction:this.onChangeRecentsVisibility}),i.createElement("div",{className:"home-access-section__content"},r,i.createElement("div",{className:t},i.createElement(a.RecentActivityContainer,n.__assign({},this.props)))))},t.displayName="HomeRecentsSection",t})(i.PureComponent);t.HomeRecentsSection=d}),define("modules/clean/react/home/home_access/recents/utils/events",["require","exports","external/react-dom","modules/clean/recent_activity/recent_activity_logger","modules/clean/react/home/util/logging/activity_logger"],function(e,t,n,i,r){"use strict";function o(e,n,i,o,a){var c=t.extractLogInfo(e,n,i,o,a);return r.homeActivityLogger.logRecentsAction(c.actionTaken,c.scope,c.itemNumber,c.extension,c.sprite,c.subgroupPosition)}Object.defineProperty(t,"__esModule",{value:!0});var a=function(e,t){return 1===e?i.ActionScopes.SINGLE:t.length===e?i.ActionScopes.AGGREGATION:i.ActionScopes.SUBSET},c=function(e){var t=e.querySelector(".file-icon__img");return t&&t.textContent?t.textContent:"thumbnail"},s=function(e){return Array.prototype.indexOf.call(e.parentNode.childNodes,e)},l=function(e,t,n,r,o){if(e===i.ActionScopes.AGGREGATION||n===i.ActionTypes.COLLAPSE||n===i.ActionTypes.UNCOLLAPSE)return"various";for(var a=0,c=["paper","folder","project"];a<c.length;a++){var s=c[a];if(t.indexOf(s)>=0)return"n/a"}var l=r[o];if(!l)return"n/a";var u=l.lastIndexOf(".");return u===-1?"":l.substr(u+1)},u=function(e,t,n,r){return e===i.ActionScopes.AGGREGATION?n.props.recentItem?0:t+1:e===i.ActionScopes.SUBSET?r.classList.contains("recents-item")?0:1:0};t.extractLogInfo=function(e,t,i,r,o){var d=n.findDOMNode(t),m=a(r,i),_=c(d);return{actionTaken:e,scope:m,itemNumber:s(d),extension:l(m,_,e,i,o||0),sprite:_,subgroupPosition:u(m,o||0,t,d)}},t.logEvent=o}),define("modules/clean/react/home/home_access/sidebar",["require","exports","tslib","modules/clean/ajax","modules/core/browser","external/react","modules/core/i18n","external/lodash","modules/clean/react/app_actions_view","modules/clean/react/file_uploader/file_uploader","modules/clean/react/home/actions","modules/clean/react/home/post_tti/api","modules/clean/react/home/constants","modules/clean/react/home/util/logging/activity_logger","modules/clean/sharing/wizard/async_wizard_modals","modules/clean/recent_activity/actions/recent_activity_actions"],function(e,t,n,i,r,o,a,c,s,l,u,d,m,_,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleUploadFiles=function(){l.FileUploaderController.handleUploadButtonClick(!1),_.homeActivityLogger.logClickRightMenu(m.LoggingTypes.CLICK_UPLOAD_FILES)},t.handleCreateSharedFolder=function(){p.asyncShowShareAFolderWizardModal(t.props.user,function(e){_.homeActivityLogger.logClickRightMenu(m.LoggingTypes.CLICK_NEW_SHARED_FOLDER,e)})},t.handleCreatePaperDoc=function(){t.props.isPaperEnabledForUser?u.HomeActions.createPaperDocInNewTab(t.props.user.id):r.redirect("/paper"),_.homeActivityLogger.logClickRightMenu(m.LoggingTypes.CLICK_CREATE_PAPER_DOC)},t.handleCreateBrainstorm=function(){t.signInAndCreateDoc(m.PaperTemplateTypes.BRAINSTORM)},t.handleCreateMeetingNotes=function(){t.signInAndCreateDoc(m.PaperTemplateTypes.MEETING_NOTES)},t.handleCreateProjectPlan=function(){t.signInAndCreateDoc(m.PaperTemplateTypes.PROJECT_PLAN)},t.signInAndCreateDoc=function(e){if(void 0===e&&(e=""),t.props.isPaperEnabledForUser)t.createPaperDocFromTemplate(e);else{var n=function(){t.createPaperDocFromTemplate(e)};"work"===t.props.user.role?t.activateAndSignInToPaper(n):t.signInToPaper(n)}},t.activateAndSignInToPaper=function(e){i.WebRequest({url:"/team/activate_paper",data:{tos_agree:!0,notes_enabled_policy:"yes",team_id:t.props.user.team_dbtid},success:function(n){t.signInToPaper(e)}})},t.signInToPaper=function(e){t.props.isPaperEnabledForUser?e():i.WebRequest({url:"/paper/continue_from_landing_page",success:function(t){e()}})},t.createPaperDocFromTemplate=function(e){void 0===e&&(e=""),u.HomeActions.createPaperDocFromTemplateInNewTab(e),t.logForDocType(e)},t.onFileUploadComplete=c.throttle(h.refreshRecentItems,3500,{leading:!1,trailing:!0}),t}return n.__extends(t,e),t.prototype.componentDidMount=function(){l.FileUploaderController.setUser(this.props.user),d.waitForHomeTTI().then(l.FileUploaderController.loadCoreComponent)},t.prototype.logForDocType=function(e){switch(void 0===e&&(e=""),e){case m.PaperTemplateTypes.BRAINSTORM:_.homeActivityLogger.logClickRightMenu(m.LoggingTypes.CLICK_CREATE_BRAINSTORM_DOC);break;case m.PaperTemplateTypes.MEETING_NOTES:_.homeActivityLogger.logClickRightMenu(m.LoggingTypes.CLICK_CREATE_MEETING_NOTES_DOC);break;case m.PaperTemplateTypes.PROJECT_PLAN:_.homeActivityLogger.logClickRightMenu(m.LoggingTypes.CLICK_CREATE_PROJECT_PLAN_DOC)}},t.prototype.shouldVariantShowCreateDocLink=function(){return"V0"===this.props.paperLinksVariant||"V2"===this.props.paperLinksVariant},t.prototype.getPaperLinkDocTypes=function(){switch(this.props.paperLinksVariant){case m.PaperSidebarLinkVariants.V1:case m.PaperSidebarLinkVariants.V2:return[m.PaperTemplateTypes.BRAINSTORM,m.PaperTemplateTypes.MEETING_NOTES,m.PaperTemplateTypes.PROJECT_PLAN];case m.PaperSidebarLinkVariants.V0:default:return[]}},t.prototype.getPath=function(){return this.props.user.is_cdm_member?this.props.user.cdm_tmf_path:"/"},t.prototype.render=function(){var e=[{displayName:a._("New shared folder"),iconName:"new-shared-folder",className:"action-new-shared-folder",handleClick:this.handleCreateSharedFolder}];this.props.isPaperEnabledForUser?e.push({displayName:a._("Create Paper doc"),iconName:"new-paper-doc",className:"action-new-paper-doc",handleClick:this.handleCreatePaperDoc}):this.shouldVariantShowCreateDocLink()&&e.push({displayName:a._("Create Paper doc"),iconName:"new-paper-doc",className:"action-new-paper-doc",handleClick:this.handleCreatePaperDoc});for(var t=this.getPaperLinkDocTypes(),n=0,i=t;n<i.length;n++){switch(i[n]){case m.PaperTemplateTypes.BRAINSTORM:e.push({displayName:a._("Start a brainstorm"),iconName:"brainstorm",className:"action-new-paper-doc",handleClick:this.handleCreateBrainstorm});break;case m.PaperTemplateTypes.MEETING_NOTES:e.push({displayName:a._("Create meeting notes"),iconName:"new-meeting-note",className:"action-new-paper-doc",handleClick:this.handleCreateMeetingNotes});break;case m.PaperTemplateTypes.PROJECT_PLAN:e.push({displayName:a._("Plan your project"),iconName:"select",className:"action-new-paper-doc",handleClick:this.handleCreateProjectPlan})}}return o.createElement("div",{className:"home-access-sidebar"},o.createElement(l.FileUploaderController,{loadOnRender:!1,needToSetStoreValues:!0,dragAndDropEnabled:!1,initialPath:this.getPath(),onFileUploadComplete:this.onFileUploadComplete,chooseDestination:!0}),o.createElement(s.AppActionsView,{responsive:this.props.responsive,primaryMenuItem:{displayName:a._("Upload files"),handleClick:this.handleUploadFiles,className:"action-upload",iconName:"upload"},secondaryMenuItems:e}))},t})(o.PureComponent);t.HomeSidebar=E}),define("modules/clean/react/home/post_tti/api",["require","exports","tslib","modules/clean/web_timing_logger","modules/clean/react/async/loadable"],function(e,t,n,i,r){"use strict";function o(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return[4,i.waitForTTI()];case 1:return t.sent(),[4,new Promise(function(t,n){e(["modules/clean/react/home/post_tti/interface"],t,n)})];case 2:return[2,t.sent()]}})})}function a(e){var t=this,i=e.getPostTTIRenderer,a=e.preTTIRenderer;return r.Loadable({loader:function(){return n.__awaiter(t,void 0,void 0,function(){var e;return n.__generator(this,function(t){switch(t.label){
case 0:return e=i,[4,o()];case 1:return[2,e.apply(void 0,[t.sent()])]}})})},loading:a})}Object.defineProperty(t,"__esModule",{value:!0}),t.waitForHomeTTI=o,t.PostHomeTTIComponent=a}),define("modules/clean/react/home/resource/store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/constants","modules/clean/react/starred/constants","modules/clean/react/starred/id_type_pair","modules/clean/flux/flux_store"],function(e,t,n,i,r,o,a,c){"use strict";function s(){return null===u&&(u=new l),u}Object.defineProperty(t,"__esModule",{value:!0});var l=(function(e){function t(){var t=e.call(this,i.Dispatcher)||this;return t.pendingPreviewResourceId=null,t.resourceIdToFile={},t.fileToPreview=null,t.resourceIdToEquivalentResourceId={},t}return n.__extends(t,e),t.prototype.getFileToPreview=function(){return this.fileToPreview},t.prototype.emitIfPendingFileExists=function(){if(null!==this.pendingPreviewResourceId){var e=this.resourceIdToEquivalentResourceId[this.pendingPreviewResourceId]||this.pendingPreviewResourceId;this.fileToPreview=this.resourceIdToFile[this.pendingPreviewResourceId]||this.resourceIdToFile[e]||null,null!==this.fileToPreview&&(this.pendingPreviewResourceId=null,this.__emitChange())}},t.prototype.onRequestPreview=function(e){this.pendingPreviewResourceId=e,this.emitIfPendingFileExists()},t.prototype.onReceivedResourceIdToFile=function(e){this.resourceIdToFile=n.__assign({},this.resourceIdToFile,e),this.emitIfPendingFileExists()},t.prototype.onStarredSetStatus=function(e){var t=this;e.forEach(function(e){if(e.canonicalIdTypePair){var n=a.idTypePairToString(e.idTypePair),i=a.idTypePairToString(e.canonicalIdTypePair);n!==i&&(t.resourceIdToEquivalentResourceId[i]=n,t.resourceIdToEquivalentResourceId[n]=i)}}),this.emitIfPendingFileExists()},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case r.HomeResourceStoreActionTypes.REQUEST_PREVIEW:this.onRequestPreview(t.resourceId);break;case r.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE:this.onReceivedResourceIdToFile(t.resourceIdToFile);break;case o.StarredActionTypes.SET_STATUS:this.onStarredSetStatus(t.starredStatuses)}},t})(c.FluxStore);t.HomeResourceStore=l;var u=null;t.getHomeResourceStore=s}),define("modules/clean/react/home/section_header",["require","exports","tslib","external/react","modules/clean/user_education/user_education_client"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderButton=function(){return this.props.buttonText&&this.props.buttonAction?i.createElement("div",{className:"home-section-header__button"},i.createElement("button",{className:"button-as-link",onClick:this.props.buttonAction},this.props.buttonText)):null},t.prototype.render=function(){return i.createElement("h2",{className:"home-access-section__header"},i.createElement("div",{className:"home-access-section__title"},i.createElement("div",{className:"home-access-section__title-text"},i.createElement(r.UserEducationEffect,{containerName:"home-section-header",name:this.props.ueName},this.props.title))),this.renderButton())},t.displayName="SectionHeader",t})(i.PureComponent);t.SectionHeader=o}),define("modules/clean/react/home/starred/starred_empty_state",["require","exports","external/react","modules/core/i18n","external/spectrum/tip_card","modules/clean/react/home/section_header"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredHeader=function(){return n.createElement(o.SectionHeader,{title:i._("Starred",{comment:"Home's starred section"}),ueName:"starred"})},t.StarredEmptyState=function(){return n.createElement("div",{className:"starred--empty"},n.createElement(r.TipCard,null,i._("When you star items, they’ll show up here for easy access.")+" ",n.createElement("a",{href:"/help/desktop-web/star-doc-file-folder",target:"_blank",rel:"noopener noreferrer"},i._("Learn more"))))},t.StarredEmptyStateWithHeader=function(){return n.createElement("div",{className:"starred"},n.createElement(t.StarredHeader,null),n.createElement(t.StarredEmptyState,null))}}),define("modules/clean/react/home/store",["require","exports","tslib","modules/clean/flux/dispatcher","external/lodash","modules/clean/flux/flux_store","modules/clean/photos/thumb_loading/generic_thumb_store","modules/clean/react/home/constants","modules/clean/viewer","modules/core/exception"],function(e,t,n,i,r,o,a,c,s,l){"use strict";function u(){return null===g&&(g=new f),g}function d(){return u().getUser()}function m(){return d().id}function _(){return d().role}function p(e){var t={};for(var n in e)e.hasOwnProperty(n)&&(t[e[n]]=n);return t}function h(e){return!!y[e]}function E(e){return h(e)}Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){function t(){var t=e.call(this,i.Dispatcher)||this;return t.thumbStore=new a.GenericThumbStore,t.sectionToDidLoadSynchronously={},t.sectionToPendingCallbacks={},t}return n.__extends(t,e),t.prototype.getRole=function(){return this.role},t.prototype.getUser=function(){return this.user},t.prototype.getThumbStore=function(){return this.thumbStore},t.prototype.getSectionVisibility=function(){return this.sectionVisibility},t.prototype.executeWhenSectionIsReady=function(e,t,n){var i=this.getSectionLoadingPreference(e);return i===c.ConditionalSectionLoadingPreference.DO_NOT_LOAD?null:i===c.ConditionalSectionLoadingPreference.IMMEDIATE||this.getSectionLoadingMode(e)!==c.ConditionalSectionLoadingMode.UNKNOWN?n(!0):(t&&(this.sectionToPendingCallbacks[e]?this.sectionToPendingCallbacks[e].push(n):this.sectionToPendingCallbacks[e]=[n]),null)},t.prototype.getSectionLoadingPreference=function(e){if(this.sectionToExtendedConditionalData){var t=this.sectionToExtendedConditionalData[e];return t?t.isPostTTI?c.ConditionalSectionLoadingPreference.POST_TTI:c.ConditionalSectionLoadingPreference.IMMEDIATE:c.ConditionalSectionLoadingPreference.DO_NOT_LOAD}return this.role?c.ConditionalSectionLoadingPreference.IMMEDIATE:c.ConditionalSectionLoadingPreference.UNKNOWN},t.prototype.getSectionLoadingMode=function(e){if(this.sectionToExtendedConditionalData){if(this.sectionToExtendedConditionalData[e])return this.sectionToExtendedConditionalData[e].loadingMode}else if(this.role)return c.ConditionalSectionLoadingMode.SYNCHRONOUS;return c.ConditionalSectionLoadingMode.UNKNOWN},t.prototype.canRenderAllHomeSections=function(){return this.sectionToExtendedConditionalData?r.values(this.sectionToExtendedConditionalData).every(function(e){return!e.isBlocking||(!!e.isPostTTI||e.loadingMode!==c.ConditionalSectionLoadingMode.UNKNOWN)}):(this.role||l.reportStack("Called canRenderAllHomeSections before initialization",{severity:l.SEVERITY.NONCRITICAL}),!0)},t.prototype.setSectionVisibility=function(e){var t=e.section,i=e.visible;this.sectionVisibility[t]!==i&&(this.sectionVisibility=n.__assign({},this.sectionVisibility,(r={},r[t]=i,r)));var r},t.prototype.setSectionLoadingMode=function(e,t){var i=this.getExtendedConditionalData(e);i&&(this.sectionToExtendedConditionalData[e]=n.__assign({},i,{loadingMode:t}))},t.prototype.getExtendedConditionalData=function(e){return this.sectionToExtendedConditionalData&&this.sectionToExtendedConditionalData[e]},t.prototype.onInitializeStore=function(e){var t=this,i=e.role,o=e.sectionVisibility,a=e.sectionToConditionalData;this.role=i,this.sectionVisibility=o,this.user=s.Viewer.get_viewer().get_user_by_role(i),a&&(this.sectionToExtendedConditionalData=r.mapValues(a,function(e,t){return n.__assign({},e,{loadingMode:c.ConditionalSectionLoadingMode.UNKNOWN,isBlocking:E(t)})})),Object.keys(this.sectionToDidLoadSynchronously).forEach(function(e){(0,t.sectionToDidLoadSynchronously[e])(t.getSectionLoadingPreference(e))&&t.setSectionLoadingMode(e,c.ConditionalSectionLoadingMode.SYNCHRONOUS)}),this.sectionToDidLoadSynchronously={}},t.prototype.onDeclareConditionalSection=function(e){var t=e.section,n=e.didInitializeSynchronously;this.sectionToExtendedConditionalData?l.reportStack("declared conditional section too late",{severity:l.SEVERITY.CRITICAL,exc_extra:{section:t}}):this.sectionToDidLoadSynchronously[t]=n},t.prototype.onLoadedAsyncConditionalSection=function(e){var t=e.section,n=this.getExtendedConditionalData(t);n&&this.setSectionLoadingMode(t,n.isPostTTI?c.ConditionalSectionLoadingMode.POST_TTI:c.ConditionalSectionLoadingMode.ASYNCHRONOUS_PRE_TTI),(this.sectionToPendingCallbacks[t]||[]).forEach(function(e){return e(!1)}),this.sectionToPendingCallbacks[t]=[]},t.prototype.__onDispatch=function(e){var t=e.action;switch(t.type){case c.HomeActionTypes.INITIALIZE_STORE:this.onInitializeStore(t.payload);break;case c.HomeActionTypes.SET_SECTION_VISIBILITY:this.setSectionVisibility(t.payload);break;case c.HomeActionTypes.DECLARE_CONDITIONAL_SECTION:this.onDeclareConditionalSection(t.payload);break;case c.HomeActionTypes.LOADED_ASYNC_CONDITIONAL_SECTION:this.onLoadedAsyncConditionalSection(t.payload)}this.__emitChange()},t})(o.FluxStore);t.PrivateHomeStoreClass=f;var g=null;t.getHomeStore=u,t.getUser=d,t.getUserId=m,t.getRole=_;var y=p(c.HomeSections);t.isHomeSection=h,t.isBlockingSection=E}),define("modules/clean/react/home/util/conditional",["require","exports","tslib","external/react","modules/clean/react/async/loadable","modules/clean/react/home/post_tti/api","modules/clean/react/home/store","modules/clean/react/home/constants","modules/clean/react/home/util/logging/timing_logger","modules/core/exception","modules/clean/flux/dispatcher"],function(e,t,n,i,r,o,a,c,s,l,u){"use strict";function d(e){var d=this,m=e.section,_=e.syncLoader,p=e.asyncLoader,h=e.loading,E=null,f=c.ConditionalSectionLoadingPreference.UNKNOWN,g=function(e){if(f=e,e===c.ConditionalSectionLoadingPreference.UNKNOWN||e===c.ConditionalSectionLoadingPreference.DO_NOT_LOAD)return!1;var t=e===c.ConditionalSectionLoadingPreference.POST_TTI;if(t)a.isHomeSection(m)&&s.homeTimingLogger.logEmptySection(m);else{try{E=_()}catch(e){}if(E)return!0}var i=!t&&a.isBlockingSection(m),l=function(){return n.__awaiter(d,void 0,void 0,function(){var e;return n.__generator(this,function(n){switch(n.label){case 0:return t?[4,o.waitForHomeTTI()]:[3,2];case 1:n.sent(),n.label=2;case 2:return[4,p()];case 3:return e=n.sent(),i&&(E=e),u.Dispatcher.dispatch({type:c.HomeActionTypes.LOADED_ASYNC_CONDITIONAL_SECTION,payload:{section:m}}),[2,e]}})})};return i?l():E=r.Loadable({loader:l,loading:h}),!1};return a.getHomeStore(),u.Dispatcher.dispatch({type:c.HomeActionTypes.DECLARE_CONDITIONAL_SECTION,payload:{section:m,didInitializeSynchronously:g}}),function(e){return(f===c.ConditionalSectionLoadingPreference.UNKNOWN||!E&&f!==c.ConditionalSectionLoadingPreference.DO_NOT_LOAD&&a.isBlockingSection(m)&&t.IS_PROD)&&l.reportStack("Premature render",{severity:l.SEVERITY.CRITICAL,exc_extra:{section:m,loadingPreference:f,isBlockingSection:a.isBlockingSection(m)}}),E?i.createElement(E,n.__assign({},e)):i.createElement("div",null)}}Object.defineProperty(t,"__esModule",{value:!0}),t.IS_PROD=!0,t.homeConditionalSection=d}),define("modules/clean/react/home/util/conditional_api",["require","exports","modules/clean/react/home/store","modules/clean/react/home/constants"],function(e,t,n,i){"use strict";function r(e,i,r,o,a){return void 0===i&&(i=!0),t.sectionToConditionalInterface[r]?e(t.sectionToConditionalInterface[r]):n.getHomeStore().executeWhenSectionIsReady(r,i,function(n){if(n&&!t.sectionToConditionalInterface[r])try{t.sectionToConditionalInterface[r]=o()}catch(e){}return t.sectionToConditionalInterface[r]?e(t.sectionToConditionalInterface[r]):(i&&a().then(function(n){t.sectionToConditionalInterface[r]=n,e(n)}),null)})}function o(t,n){return void 0===n&&(n=!0),r(t,n,i.HomeSections.STARRED,function(){return e("modules/clean/react/home/starred/conditional_interface")},function(){return new Promise(function(t,n){e(["modules/clean/react/home/starred/conditional_interface"],t,n)})})}Object.defineProperty(t,"__esModule",{value:!0}),t.sectionToConditionalInterface={},t.waitForSection=r,t.waitForStarred=o}),define("modules/clean/react/home/util/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.HOME_V1_USER_EDUCATION_STEP_NAMES={START:"start",RECENTLY_VIEWED:"recently_viewed",FILES:"files",PAPER:"paper"}}),define("modules/clean/react/home/util/experiment_hook",["require","exports"],function(e,t){"use strict";function n(e,t){this[e]=t}function i(e){o=e}function r(){return o}Object.defineProperty(t,"__esModule",{value:!0}),t.experimentOverride=n;var o={};t.setRunningExperiments=i,t.getRunningExperiments=r}),define("modules/clean/react/home/util/experiment_override",["require","exports","tslib","modules/clean/react/home/experiment_config","external/eventemitter3","external/lodash","modules/core/exception","modules/clean/react/home/util/experiment_hook"],function(e,t,n,i,r,o,a,c){"use strict";function s(){t.experimentsLoaded=!1}function l(e,t){a.reportStack(e,{severity:a.SEVERITY.NONCRITICAL,exc_extra:t})}function u(e,t,n){var i=t.original().then(function(e){t.originalModule=e[0]}).catch(function(t){l("Error loading original module for experiment",{experimentName:n,reason:t}),delete e[n]}),r=t.experiment().then(function(e){t.experimentModule=e[0]}).catch(function(t){l("Error loading experiment module for experiment",{experimentName:n,reason:t}),delete e[n]});return Promise.all([i,r])}function d(e){return n.__awaiter(this,void 0,void 0,function(){var r,a,s,d,m;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,3,4]),r={},e&&(r=Object(o.pick(i.getExperiments(),Object.keys(e)))),o.isEmpty(r)?[2]:(a=o.flatten(Object.keys(r).map(function(e){return o.map(r[e],function(t){return u(r,t,e)})})),s={},d=[],[4,Promise.all(a)]);case 1:return n.sent(),Object.keys(r).forEach(function(e){r[e].forEach(function(t){t.keys.forEach(function(n){t.originalModule&&t.originalModule.hasOwnProperty(n)||(s[e]=[n].concat(s[e]||[]),delete r[e])}),t.originalModule&&t.originalModule.hasOwnProperty("experimentOverride")||(d.push(e),delete r[e])})}),o.isEmpty(s)||l("Experiment overriding nonexistent export key",{missingKeys:s}),o.isEmpty(d)||l("Experiment source file missing hook",{missingHookExperiments:d}),o.flatten(o.values(r)).forEach(function(e){e.keys.forEach(function(t){return e.originalModule.experimentOverride(t,e.experimentModule[t])})}),c.setRunningExperiments(o.pick(e,Object.keys(r))),[3,4];case 2:return m=n.sent(),l("Unexpected error while performing experiment overrides",{error:m}),[3,4];case 3:return t.eventEmitter.emit("modulesLoaded"),t.eventEmitter.removeAllListeners(),t.experimentsLoaded=!0,[7];case 4:return[2]}})})}function m(e){t.experimentsLoaded?e():t.eventEmitter.once("modulesLoaded",e)}function _(e){t.eventEmitter.removeListener("modulesLoaded",e)}Object.defineProperty(t,"__esModule",{value:!0}),t.eventEmitter=new r,t.experimentsLoaded=!1,t.reset=s,t.performOverrides=d,t.registerExperimentsLoadedCallback=m,t.clearExperimentsLoadedCallback=_}),define("modules/clean/react/home/util/home_experiment",["require","exports","tslib","external/react","modules/clean/react/home/util/experiment_override"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(e){function t(t){var n=e.call(this,t)||this;return n.state={waitingForExperiments:!0},r.performOverrides(n.props.activeExperiments),n}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;r.registerExperimentsLoadedCallback(function(){e.doneWaiting()})},t.prototype.componentWillUnmount=function(){var e=this;r.clearExperimentsLoadedCallback(function(){e.doneWaiting()})},t.prototype.render=function(){return this.state.waitingForExperiments?this.props.placeholder:i.Children.only(this.props.children)},t.prototype.doneWaiting=function(){this.setState({waitingForExperiments:!1})},t})(i.Component);t.HomeExperiment=o}),define("modules/clean/react/home/util/logging/activity_logger",["require","exports","modules/clean/react/home/api","modules/clean/react/home/store","modules/clean/react/home/constants"],function(e,t,n,i,r){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(){}return e.prototype.logClickShowAll=function(e,t){return n.logHomeActivity({eventName:r.LoggingTypes.CLICK_SHOW_ALL,role:i.getHomeStore().getRole(),extra:{component_name:e,should_show_all:t}})},e.prototype.logHomePageShown=function(){return n.logHomeActivity({eventName:r.LoggingTypes.HOME_PAGE_SHOWN,role:i.getHomeStore().getRole(),extra:{}})},e.prototype.logStarredShown=function(e,t,o){return n.logHomeActivity({eventName:r.LoggingTypes.STARRED_SHOWN,role:i.getHomeStore().getRole(),extra:{num_items:e,is_hidden:!1,has_hidden_rows:t,has_more:o}})},e.prototype.logRecentsShown=function(e,t){return n.logHomeActivity({eventName:r.LoggingTypes.RECENTS_SHOWN,role:i.getHomeStore().getRole(),extra:{num_items:e,is_hidden:t}})},e.prototype.logShowHideSection=function(e,t){return n.logHomeActivity({eventName:t?r.LoggingTypes.HIDE_SECTION:r.LoggingTypes.UNHIDE_SECTION,role:i.getHomeStore().getRole(),extra:{section_name:e}})},e.prototype.logRecentsAction=function(e,t,o,a,c,s){return n.logHomeActivity({eventName:r.LoggingTypes.RECENTS_ITEM_ACTION,role:i.getHomeStore().getRole(),extra:{action_taken:e,scope:t,item_number:o,extension:a,sprite:c,subgroup_position:s}})},e.prototype.logOpenStarredItem=function(e,t,o,a){return n.logHomeActivity({eventName:r.LoggingTypes.OPEN_STARRED_ITEM,role:i.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:a}})},e.prototype.logUndoUnstarItem=function(e,t,o,a){return n.logHomeActivity({eventName:r.LoggingTypes.UNDO_UNSTAR_ITEM,role:i.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:a}})},e.prototype.logClickStarOverflowMenu=function(e,t,o,a){return n.logHomeActivity({eventName:r.LoggingTypes.CLICK_STAR_OVERFLOW_MENU,role:i.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:a}})},e.prototype.logClickStarOverflowShare=function(e,t,o,a){return n.logHomeActivity({eventName:r.LoggingTypes.CLICK_STAR_OVERFLOW_SHARE,role:i.getHomeStore().getRole(),extra:{resource_id:e,resource_type:t,position:a}})},e.prototype.logClickRightMenu=function(e,t){var r=t?{modalSessionId:t}:{};return n.logHomeActivity({eventName:e,role:i.getHomeStore().getRole(),extra:r})},e.prototype.logViewUploadedFiles=function(e,t){return n.logHomeActivity({eventName:r.LoggingTypes.VIEW_UPLOADED_FILES,role:i.getHomeStore().getRole(),extra:{num_items:e,num_selected_items:t}})},e})();t.HomeActivityLogger=o,t.homeActivityLogger=new o}),define("modules/clean/react/home/util/logging/availability_logger",["require","exports","tslib","external/lodash","modules/clean/react/home/constants","modules/clean/perf_tools/resource_utils","modules/clean/web_timing_logger","modules/clean/react/home/api","modules/clean/react/home/store","modules/core/exception","modules/clean/react/home/util/experiment_hook"],function(e,t,n,i,r,o,a,c,s,l,u){"use strict";function d(){return p=p||new _}Object.defineProperty(t,"__esModule",{value:!0});var m=(h={},h[r.HomePrefetchTypes.RETRIEVE_STARRED]={fragment:"retrieve_starred",handle:"__REGISTER_RETRIEVE_STARRED_PRELOAD_HANDLER",section:r.HomeSections.STARRED,conditionalSection:r.HomeSections.STARRED},h[r.HomePrefetchTypes.RECENTS_JSON]={fragment:"recents/json",handle:"__REGISTER_RECENTS_PRELOAD_HANDLER",section:r.HomeSections.RECENTS,conditionalSection:r.HomeSections.RECENTS},h[r.HomePrefetchTypes.RETRIEVE_PAPER_RECENTS]={fragment:"retrieve_paper_recents",handle:"__REGISTER_PAPER_RECENTS_PRELOAD_HANDLER",section:r.HomeSections.RECENTS,conditionalSection:r.ConditionalSections.PAPER_RECENTS},h[r.HomePrefetchTypes.RETRIEVE_UNREAD]={fragment:"retrieve_unread",handle:"__REGISTER_UNREAD_PREFETCH_HANDLER",section:r.HomeSections.UNREAD,conditionalSection:r.HomeSections.UNREAD},h),_=(function(){function e(){var e=this;this.reportMissingPrefetches=i.once(function(){var t=window,n=i.filter(e.typeToExecutionData,function(e,n){return 0===e.attempts&&!t[m[n].handle]});n.length&&l.reportStack("No prefetch handle (possibly double prefetch)",{severity:l.SEVERITY.NONCRITICAL,exc_extra:{runningExperiments:u.getRunningExperiments(),typesWithoutPrefetches:n,typeToExecutionData:e.typeToExecutionData}})}),this.didLog=!1,this.logTimeoutHandle=null,this.sectionToTTData={},this.sectionToTTI={},this.sectionsWaitingForTTI=[],this.undonePrefetchesCount=Object.keys(r.HomePrefetchTypes).length,this.typeToExecutionData=i.mapValues(m,function(e){return{info:e,attempts:0,success:!1,done:!1,isPrefetch:!1}})}return e.prototype.canLog=function(){var e=this;return!this.didLog&&(!(this.undonePrefetchesCount>0)&&(!this.sectionsWaitingForTTI.length||(null===this.logTimeoutHandle&&(this.logTimeoutHandle=setTimeout(function(){e.didLog||(e.log(),l.reportStack("Unexpected failure to reach TTI",{severity:l.SEVERITY.NONCRITICAL,exc_extra:{runningExperiments:u.getRunningExperiments(),sectionToTTI:e.sectionToTTI,sectionToTTData:e.sectionToTTData}}))},2e4)),!1)))},e.prototype.log=function(){var e=this,t={};Object.keys(r.HomeSections).forEach(function(n){var i=r.HomeSections[n];t[i]={tti:e.sectionToTTI[i],tt_data:e.sectionToTTData[i]}});var n=s.getHomeStore(),o=n.getUser();o?c.makeRequest({url:"/log/home_availability",type:"POST",dataType:"text",subject_user:o.id,data:{success:i.values(this.typeToExecutionData).every(function(e){return e.success})&&i.size(this.sectionToTTI)===i.size(r.HomeSections),sections_json:JSON.stringify(t),prefetches_json:JSON.stringify(i.mapValues(this.typeToExecutionData,function(e,t){var i=m[t].section,r=e.timing||{};return{success:e.success,did_fallback:!e.isPrefetch||e.attempts>1,fetch_start:r.fetchStart,domain_lookup_start:r.domainLookupStart,domain_lookup_end:r.domainLookupEnd,redirect_start:r.redirectStart||n.getSectionLoadingPreference(i),request_start:r.requestStart||n.getSectionLoadingMode(i),connect_start:r.connectStart||e.connectStart,connect_end:r.connectEnd||e.connectEnd,redirect_end:r.redirectEnd||e.redirectEnd,start_time:r.startTime||e.startTime,response_start:r.responseStart||e.responseStart,response_end:r.responseEnd||e.responseEnd,transfer_size:r.transferSize||e.transferSize}}))}},{isBackground:!0,delayRequest:!0}):l.reportStack("No user in HomeStore",{severity:l.SEVERITY.NONCRITICAL}),null!==this.logTimeoutHandle&&clearTimeout(this.logTimeoutHandle),this.didLog=!0},e.prototype.logIfPossible=function(){this.canLog()&&this.log()},e.prototype.logPrefetch=function(e,t){var n=this.typeToExecutionData[e];n.done||(0===n.attempts&&(n.timing=o.logResourceTiming(n.info.fragment)),t&&(n.success=!0,this.sectionToTTI.hasOwnProperty(n.info.section)||this.sectionsWaitingForTTI.push(n.info.section)),n.attempts+=1,(n.success||n.attempts>1)&&(n.done=!0,this.undonePrefetchesCount--,this.logIfPossible()))},e.prototype.logTTData=function(e){this.sectionToTTData.hasOwnProperty(e)||(this.sectionToTTData[e]=a.time_since_start(),this.logIfPossible())},e.prototype.logTTI=function(e){this.sectionToTTI.hasOwnProperty(e)||(this.sectionToTTI[e]=a.time_since_start(),this.sectionsWaitingForTTI=i.without(this.sectionsWaitingForTTI,e),this.logIfPossible())},e.prototype.handlePrefetch=function(e,t,r){var o=this,c=window,s=m[e].handle,u=c[s],d=this.typeToExecutionData[e],_=function(n){o.logPrefetch(e,!0),d.connectStart=a.time_since_start(),t(n),d.connectEnd=a.time_since_start()},p=function(t,n){l.reportStack((t?"fallback":"prefetch")+" for "+e+" failed",{severity:t?l.SEVERITY.CRITICAL:l.SEVERITY.NONCRITICAL,exc_extra:{error:n}}),o.logPrefetch(e,!1)},h=function(){return n.__awaiter(o,void 0,void 0,function(){var e,t;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),e=_,[4,r()];case 1:return e.apply(void 0,[n.sent()]),[3,3];case 2:return t=n.sent(),p(!0,t),[3,3];case 3:return[2]}})})},E=function(e){p(!1,e),h()};if(u)if(d.isPrefetch)h();else{d.isPrefetch=!0,d.startTime=a.time_since_start();var f=function(e){try{d.responseStart=a.time_since_start();var t=JSON.parse(e);d.responseEnd=a.time_since_start(),d.transferSize=16*e.length,i.isEqual(t,{})?E("payload is {}"):_(t)}catch(e){E(e)}},g=u.getDataIfAvailable();if(d.redirectEnd=g?0:1,g){var y=g.error,v=g.payload;y?E(y):f(v)}else u(f,E)}else this.reportMissingPrefetches(),E("no prefetch handler")},e})();t.HomeAvailabilityLogger=_;var p=null;t.getHomeAvailabilityLogger=d;var h}),define("modules/clean/react/home/util/logging/timing_component",["require","exports","tslib","external/react","modules/clean/react/home/util/logging/timing_logger"],function(e,t,n,i,r){"use strict";function o(e,t){return(function(o){function a(){return null!==o&&o.apply(this,arguments)||this}return n.__extends(a,o),a.prototype.componentDidMount=function(){r.homeTimingLogger.logTTI(t);var e=this.refs.wrapped,n=e.componentDidUpdate;e.componentDidUpdate=function(){r.homeTimingLogger.logTTI(t),n&&n.call(e)}},a.prototype.render=function(){return i.createElement(e,n.__assign({ref:"wrapped"},this.props))},a})(i.PureComponent)}Object.defineProperty(t,"__esModule",{value:!0}),t.timingComponent=o}),define("modules/clean/react/home/util/logging/timing_logger",["require","exports","modules/clean/js_client_stopwatch","external/lodash","modules/clean/web_timing_logger","modules/clean/react/home/util/logging/timing_state","modules/clean/react/home/util/logging/activity_logger","modules/core/exception","modules/clean/react/home/util/logging/availability_logger"],function(e,t,n,i,r,o,a,c,s){"use strict";function l(e){return"home_"+e}Object.defineProperty(t,"__esModule",{value:!0});var u=i.once(function(){return a.homeActivityLogger.logHomePageShown()}),d=(function(){function e(){this.timingStates=new o.HomeTimingStates,this.activate=i.once(function(){return n.JSStopwatch.create_stopwatch_if_not_exist("home_access_tti")})}return e.prototype.validateActivated=function(e,t){return!!n.JSStopwatch.stopwatch_exists("home_access_tti")||(c.reportStack("Did not activate when "+e+" before logging "+t,{severity:c.SEVERITY.NONCRITICAL}),!1)},e.prototype.registerLoadCallback=function(e,t){var n=-1;this.triggerPageLoad=function(){clearTimeout(n),e()};var i=r.time_since_start()||2e3;n=setTimeout(this.triggerPageLoad,Math.max(t-i,0))},e.prototype.logTTData=function(e){if(this.validateActivated(e,o.HomeTimingState.TTDATA)){if(this.timingStates.progressState(e,o.HomeTimingState.TTDATA))return this.timingStates.haveAllSectionsReachedState(o.HomeTimingState.TTDATA)&&r.log_js_modules_fetched_data_required_for_tti(),s.getHomeAvailabilityLogger().logTTData(e),!0}return!1},e.prototype.logEmptySection=function(e){this.activate(),this.logTTData(e),this.logTTI(e)},e.prototype.logTTI=function(e){if(this.validateActivated(e,o.HomeTimingState.TTI)){this.timingStates.progressState(e,o.HomeTimingState.TTI)&&(u(),n.JSStopwatch.recordTrace(l(e),{stopwatchName:"home_access_tti"}),this.timingStates.haveAllSectionsReachedState(o.HomeTimingState.TTI)&&(this.triggerPageLoad&&this.triggerPageLoad(),r.mark_time_to_interactive(),n.JSStopwatch.flush_current_data()),s.getHomeAvailabilityLogger().logTTI(e))}},e})();t._HomeTimingLogger=d,t.homeTimingLogger=new d,t.withHomePrefix=l}),define("modules/clean/react/home/util/logging/timing_state",["require","exports","external/lodash","modules/clean/react/home/constants"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r;(function(e){e[e.INIT=0]="INIT",e[e.TTDATA=1]="TTDATA",e[e.TTI=2]="TTI"})(r=t.HomeTimingState||(t.HomeTimingState={}));var o=(function(){function e(){var e=this;this.loggingSectionToState={},n.values(i.HomeSections).forEach(function(t){return e.loggingSectionToState[t]=r.INIT})}return e.prototype.progressState=function(e,t){return this.loggingSectionToState[e]+1===t&&(this.loggingSectionToState[e]=t,!0)},e.prototype.getSectionsPreTTI=function(){return Object.keys(n.pickBy(this.loggingSectionToState,function(e){return e!==r.TTI}))},e.prototype.haveAllSectionsReachedState=function(e){return n.every(this.loggingSectionToState,function(t){return t>=e})},e})();t.HomeTimingStates=o}),define("modules/clean/react/home/util/navigation",["require","exports","modules/core/browser"],function(e,t,n){"use strict";function i(e){return e.metaKey||e.ctrlKey}function r(e){return i(e)?a.NEW_TAB:a.REDIRECT}function o(e,t,i){switch(void 0===i&&(i=a.NEW_TAB),i){case a.REDIRECT:return void(t?t().then(function(){return n.redirect(e)}):n.redirect(e));case a.NEW_TAB:n.open_tab(e);break;case a.UNSAFE_NEW_TAB:n.unsafe_open_tab(e)}t&&t()}Object.defineProperty(t,"__esModule",{value:!0});var a;(function(e){e[e.REDIRECT=1]="REDIRECT",e[e.NEW_TAB=2]="NEW_TAB",e[e.UNSAFE_NEW_TAB=3]="UNSAFE_NEW_TAB"})(a=t.NavigationMethod||(t.NavigationMethod={})),t.isMetaKeyPressed=i,t.getNavigationMethod=r,t.logAndNavigate=o}),define("modules/clean/react/home/util/resource_icon",["require","exports","tslib","external/react","external/spectrum/icon_content","external/spectrum/file_icon","modules/clean/react/home/constants"],function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.renderIcon=function(){if(a.DisplayTypeToResourceType[this.props.displayType]===a.FILE_RESOURCE_TYPE)return i.createElement(o.FileIcon,{path:this.props.fileName,variant:this.props.variant});var e=a.DisplayTypeToIconName[this.props.displayType]||"unknown";return i.createElement(r.IconContent,{name:e+"-"+this.props.variant})},t.prototype.render=function(){return i.createElement("span",{className:this.props.className},this.renderIcon())},t.displayName="HomeResourceIcon",t})(i.PureComponent);t.HomeResourceIcon=c}),define("modules/clean/react/home/util/show_hide_link",["require","exports","tslib","external/classnames","external/react","external/spectrum/icon_arrow","modules/core/i18n"],function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.getLinkText=function(){return this.props.isExpanded?a._("Collapse section"):this.props.hiddenItemCount<=0?a._("Show more"):this.props.canLoadMore?a._("Show %(number)s+ more").format({number:this.props.hiddenItemCount}):a._("Show %(number)s more").format({number:this.props.hiddenItemCount})},t.prototype.getLinkClass=function(){return i({"button-as-link":!0,"show-hide-link":!0,"show-hide-link--expanded":this.props.isExpanded})},t.prototype.render=function(){return r.createElement("div",{className:"show-hide-link__container"},r.createElement("button",{onClick:this.props.onClick,className:this.getLinkClass()},r.createElement("div",{className:"show-hide-link__arrow"},r.createElement(o.IconArrow,{name:"right"})),this.getLinkText()))},t.displayName="ShowHideLink",t})(r.PureComponent);t.ShowHideLink=c}),define("modules/clean/react/home/util/static_tooltip",["require","exports","external/react","external/react-dom","modules/clean/react/bubble_dropdown_v2","modules/clean/react/sprite","modules/core/i18n"],function(e,t,n,i,r,o,a){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var c=(function(){function e(){var e=this;this.isTooltipTriggered=!1,this.onTooltipTriggerRendered=function(t){e.isTooltipTriggered||(e.isTooltipTriggered=!0,e.triggerButton=t,e.simulateTriggerButtonClick())},this.simulateTriggerButtonClick=function(){e.triggerButton.click()},this.show=function(t,c,s,l,u,d,m){void 0===m&&(m="");var _=n.createElement("button",{className:"home-tooltip__trigger-button",ref:e.onTooltipTriggerRendered,"aria-label":"close"}),p=n.createElement(r.BubbleDropdown,{className:"home-tooltip",position:l,targetButton:_,onShowDropdown:u||function(){},onHideDropdown:d||function(){}},n.createElement("h4",{className:"home-tooltip__title"},t),c,n.createElement("button",{
className:"home-tooltip__close-button",onClick:e.simulateTriggerButtonClick,"aria-label":a._("Close tooltip")},n.createElement(o.Sprite,{group:"web",name:"lightbox_close",alt:a._("Close")}))),h=e.createMountingElement(m);s.appendChild(h),i.render(p,h)},this.hide=function(){e.simulateTriggerButtonClick()}}return e.prototype.createMountingElement=function(e){var t=document.createElement("DIV");return e&&(t.className=e),t.addEventListener("click",function(e){e.preventDefault()}),t},e.POSITIONS=r.BubbleDropdown.POSITIONS,e})();t.StaticTooltip=c}),define("modules/clean/react/starred/constants",["require","exports"],function(e,t){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.StarredLoadingState={LOADING:"LOADING",LOAD_SUCCESS:"LOAD_SUCCESS",LOAD_FAILED:"LOAD_FAILED"},t.StarredActionTypes={LOADING:"STARRED_LOADING",SET_STATUS:"STARRED_SET_STATUS",LOAD_FAILURE:"STARRED_LOAD_FAILURE",RENAME_EXTERNAL_RESOURCE:"STARRED_RENAME_EXTERNAL_RESOURCE"},t.IdTypes={ENCODED_FILE_OBJ_ID:"ENCODED_FILE_OBJ_ID",EXTERNAL_RESOURCE_ID:"EXTERNAL_RESOURCE_ID",PAPER_ID_PATH:"PAPER_ID_PATH",FQ_PATH:"FQ_PATH"};(function(e){e.HOME_STARRED="HOME_STARRED",e.HOME_RECENTS="HOME_RECENTS",e.BROWSE="BROWSE",e.FILE_VIEWER="FILE_VIEWER",e.SUGGESTED_STARS="SUGGESTED_STARS"})(t.StarredSource||(t.StarredSource={})),t.StarExtensionId_DEV="bkoifdjjfabbedgjlkmkcabdpajmmlhd",t.StarExtensionId_PROD="hjdobpfegefofikebjlabkpjlndkfefg"}),define("modules/clean/react/starred/id_type_pair",["require","exports"],function(e,t){"use strict";function n(e){return e.type+":"+e.id}Object.defineProperty(t,"__esModule",{value:!0}),t.idTypePairToString=n}),define("modules/clean/recent_activity/actions/error_actions",["require","exports","external/lodash","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/core/exception","modules/core/i18n","modules/core/notify"],function(e,t,n,i,r,o,a,c){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var s=(function(){function e(e){var t=this;this._flushQueues=function(){t._rafId=null;var e=t._recentActivityQueue;t._recentActivityQueue=[],e.length&&t._dispatcher.dispatch({type:i.RAW_RECENT_ACTIVITY_PARSE_ERROR,errors:e});var n=t._relatedActivityQueue;t._relatedActivityQueue=[],n.length&&t._dispatcher.dispatch({type:i.RAW_RELATED_ACTIVITY_PARSE_ERROR,errors:n})},this._notify=n.throttle(function(){var e=a._("Sorry, we were unable to show some recent items. The team has been notified");c.Notify.error(e)},500,{trailing:!1}),this._dispatcher=e,this._recentActivityQueue=[],this._relatedActivityQueue=[],this._rafId=null}return e.prototype.recentActivityParseError=function(e,t){o.reportException({err:t}),this._notify(),this._enqueueError(this._recentActivityQueue,e,t)},e.prototype.relatedActivityParseError=function(e,t){o.reportException({err:t}),this._notify(),this._enqueueError(this._relatedActivityQueue,e,t)},e.prototype._enqueueError=function(e,t,n){e.push({activityKey:t,error:n}),this._rafId||(this._rafId=window.requestAnimationFrame(this._flushQueues))},e})();t.ErrorActions=s,t.errorActions=new s(r.recentActivityDispatcher)}),define("modules/clean/recent_activity/actions/federated_recent_activity_actions",["require","exports","tslib","modules/core/i18n","modules/core/browser","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_federated_model","modules/clean/recent_activity/stores/recent_activity_store","modules/core/exception","modules/core/notify","modules/clean/react/home/home_access/recents/utils/events","modules/clean/recent_activity/recent_activity_logger"],function(e,t,n,i,r,o,a,c,s,l,u,d,m,_,p){"use strict";function h(e,t,n){e?r.open_tab(e):d.reportStack("Cannot open tab to preform the action "+t,{severity:d.SEVERITY.NONCRITICAL,exc_extra:{paperRecentItem:n.paperRecentItem}})}function E(e,t,n){_.logEvent(e,n.cellView,[t.getFqPath()],1,1)}function f(e,t){E(p.ActionTypes.PAPER_SHARE,e,t),h(l.getPaperShareUrl(e),p.ActionTypes.PAPER_SHARE,e)}function g(e,t){E(p.ActionTypes.PAPER_OPEN,e,t),h(e.getUrl(),p.ActionTypes.PAPER_OPEN,e)}function y(e,t){c.recentActivityDispatcher.dispatch({type:e,activityKey:t})}function v(e,t,r){var c=this,d=e.getActivityKey();if(u.getRecentActivityStore().canArchiveActivityKey(d)){var _=e.getActivityKey();o.SimpleModal.show({title_text:i._("Archive document?"),body_html:i._("Do you want to archive this document?"),confirm_text:i._("Archive"),cancel_text:i._("Cancel"),autoclose:!0,confirm_callback:function(){return n.__awaiter(c,void 0,void 0,function(){var o,c;return n.__generator(this,function(n){switch(n.label){case 0:E(p.ActionTypes.PAPER_ARCHIVE,e,r),y(a.ARCHIVE_PAPER_DOCUMENT_PENDING,_),n.label=1;case 1:return n.trys.push([1,3,,4]),[4,s.archivePaperResources(t,[e.paperRecentItem])];case 2:return o=n.sent(),o.some(function(t){return l.equalsPaperRecentItem(e,t)})?(y(a.ARCHIVE_PAPER_DOCUMENT_COMMIT,_),m.Notify.success(i._("The document was archived."))):y(a.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,_),[3,4];case 3:return c=n.sent(),y(a.ARCHIVE_PAPER_DOCUMENT_ROLLBACK,_),[3,4];case 4:return[2]}})})}})}}Object.defineProperty(t,"__esModule",{value:!0}),t.shareItem=f,t.previewItem=g,t.promptAndArchiveItem=v}),define("modules/clean/recent_activity/actions/recent_activity_action_permissions",["require","exports","modules/clean/recent_activity/models/utils"],function(e,t,n){"use strict";function i(e,t){return n.isShareLinkRecentItem(e)?r(!!t.canOpen):{open:!!t.canOpen,delete:!t.isReadOnly,download:!0,comment:!t.isDir,versions:!t.isDir,archive:!1,share:!1}}function r(e){return{archive:!1,comment:!1,delete:!1,download:!1,open:e,share:!1,versions:!1}}function o(e,t){if(e.federatedRecentItem)return{archive:e.federatedRecentItem.isArchiveable(),comment:!1,delete:!1,download:!1,open:!1,share:e.federatedRecentItem.isShareable(),versions:!1};var i=t[0],o=1===t.length;if(n.isShareLinkRecentItem(e))return r(!(!o||!i.canOpen));var a=o&&!i.isDir;return{archive:!1,comment:a,delete:t.every(function(e){return!e.isReadOnly}),download:o,open:!(!o||!i.canOpen),share:o,versions:a}}function a(e){for(var t in e)if("share"!==t&&e[t])return!0;return!1}Object.defineProperty(t,"__esModule",{value:!0}),t.getDocAttachmentViewPermissions=i,t.getRecentActivityItemViewPermissions=o,t.shouldRenderActionsMenu=a}),define("modules/clean/recent_activity/actions/recent_activity_actions",["require","exports","tslib","external/lodash","modules/clean/react/modal","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/store_utils","modules/clean/recent_activity/stores/attachment_store","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/react/home/util/navigation","modules/core/i18n","modules/clean/react/home/post_tti/api"],function(e,t,n,i,r,o,a,c,s,l,u,d,m){"use strict";function _(){var e=l.getRecentActivityStore().getFileSyncCursor();return e&&c.loadRecentItems(e),!!e}function p(){return!!l.getRecentActivityStore().getFileSyncCursor()}function h(e,t,i){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return[4,m.waitForHomeTTI()];case 1:return[4,n.sent().shareFile(e,t,i)];case 2:return n.sent(),[2]}})})}function E(e,t,r){return void 0===r&&(r=i.noop),n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return[4,m.waitForHomeTTI()];case 1:return[4,n.sent().openFile(e,t)];case 2:return n.sent(),r(),[2]}})})}function f(e,t,o){var a,c,l=this,u=function(){return n.__awaiter(l,void 0,void 0,function(){return n.__generator(this,function(t){switch(t.label){case 0:return[4,m.waitForHomeTTI()];case 1:return[2,t.sent().deleteAttachments(e,o)]}})})};if(1===e.length){var _=s.getAttachmentStore().getById(e[0]);if(_&&_.isLoaded){c=_.isDir?d._("Delete folder?"):d._("Delete file?");a=(t?d._("Are you sure you want to remove the shared folder <b>%(file_name)s</b> from your Dropbox? This shared folder will stay shared with other members and you can re-add it later."):d._("Do you want to delete <b>%(file_name)s</b>?")).format({file_name:i.escape(_.displayName||"")})}else c=d._("Delete file?"),a=d._("Do you want to delete this file?")}else c=d._("Delete files?"),a=d._("Do you want to delete <b>%(num)s files</b>?").format({num:i.escape(String(e.length))});r.SimpleModal.show({title_text:c,body_html:a,confirm_text:d._("Delete"),confirm_callback:u,cancel_text:d._("Cancel"),autoclose:!0})}function g(e,t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return[4,m.waitForHomeTTI()];case 1:return n.sent().downloadFiles(e,t),[2]}})})}function y(e,t,i){return n.__awaiter(this,void 0,void 0,function(){var r;return n.__generator(this,function(n){switch(n.label){case 0:return r=u.getNavigationMethod(t),[4,m.waitForHomeTTI()];case 1:return n.sent().openVersions(r,e,i),[2]}})})}function v(){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return l.getRecentActivityStore().didReceiveItemsFromAllStreams()?(a.recentActivityDispatcher.dispatch({type:o.REFRESH_RECENT_ACTIVITIES}),[4,Promise.all([c.loadRecentItems(),c.loadPaperRecentItems(!1)])]):[3,2];case 1:e.sent(),e.label=2;case 2:return[2]}})})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadNextPage=_,t.hasCursor=p,t.shareFile=h,t.openFile=E,t.promptAndDeleteAttachments=f,t.downloadFiles=g,t.openVersions=y,t.refreshRecentItems=v}),define("modules/clean/recent_activity/models/attachment",["require","exports","modules/core/exception"],function(e,t,n){"use strict";function i(e){var t=e.preview_jsinfo||null,i=null,r=null;if(t&&(t.thumbnail_url_tmpl&&(i=t.thumbnail_url_tmpl),t.thumbnail_dimensions)){var o=t.thumbnail_dimensions,a=o[0];r={height:o[1],width:a}}var c=e.comment||{},s=c.commenter_dict||{};return c.raw_comment_text&&n.reportStack("Received a comment attachment",{severity:n.SEVERITY.NONCRITICAL,exc_extra:{activity:e}}),{id:e.activity_key,isLoaded:!0,viewingUserId:e.viewing_user.id,displayName:e.name||null,displayType:e.activity_data&&e.activity_data.home_display_type||null,entityUri:e.entity_uri||null,previewInfo:e.preview_jsinfo||null,fqPath:e.fq_path||null,nsPath:e.ns_path||null,nsId:e.ns_id||null,thumbnailUrl:i||null,thumbnailDimensions:r||null,canOpen:!1,inRootCollection:!1,isReadOnly:!!e.is_read_only,isDir:!!e.is_dir,commentRawText:c.raw_comment_text||null,commenterId:s.id||null,commenterDisplayName:s.display_name||null,commenterPhotoUrl:s.photo_circle_url||null}}function r(e){return(e.related_activity_keys||[]).map(function(t){return{id:t,viewingUserId:e.viewing_user.id,displayName:null,displayType:null,isLoaded:!1,canOpen:!1,inRootCollection:!1,isReadOnly:!1,isDir:!1,entityUri:null,previewInfo:null,fqPath:null,nsPath:null,nsId:null,thumbnailUrl:null,thumbnailDimensions:null,commentRawText:null,commenterId:null,commenterDisplayName:null,commenterPhotoUrl:null}})}Object.defineProperty(t,"__esModule",{value:!0}),t.convertFileActivityToAttachmentItem=i,t.createPartialAttachmentsFromRecentActivity=r}),define("modules/clean/recent_activity/models/federated_recent_item",["require","exports","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_federated_model"],function(e,t,n,i){"use strict";function r(e){switch(e.action||n.PaperRecentItemAction.OPENED){case n.PaperRecentItemAction.CREATED:return n.RECENT_EVENT_TYPES.PAPER_ADD;case n.PaperRecentItemAction.EDITED:return n.RECENT_EVENT_TYPES.PAPER_EDIT;default:return n.RECENT_EVENT_TYPES.PAPER_VIEW}}function o(e,t,o){var a=new i.FederatedRecentItem(e),c=a.getActivityKey();return{federatedRecentItem:a,id:c,idType:e.id_type,resourceId:e.resource_id,type:r(e),icon:a.getIcon(),displayType:e.display_type,when:e.time,viewingUserId:t.id,displayName:e.name,accountDisplayName:t.display_name,contextDisplayName:a.getFolderPath()||t.display_name,attachmentIds:[c],paths:e.path,order:o,uniqueFilterTypes:[n.RECENT_EVENT_FILTER_TYPE.DOCUMENTS]}}Object.defineProperty(t,"__esModule",{value:!0}),t.createRecentItemFromPaperRecentItem=o}),define("modules/clean/recent_activity/models/recent_item",["require","exports","external/lodash","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/models/utils"],function(e,t,n,i,r){"use strict";function o(e){try{var t=e.skeleton_data;return{id:e.activity_key,type:e.recent_event_type||null,icon:t&&t.icon||null,displayType:e.activity_data&&e.activity_data.home_display_type||null,when:e.when_milli||null,viewingUserId:e.viewing_user.id,displayName:t&&t.display_name||null,accountDisplayName:t&&t.account_display_name||null,contextDisplayName:t&&t.context_display_name||null,uniqueFilterTypes:t?n.uniq(n.values(t.filter_types_by_key)):[],attachmentIds:e.related_activity_keys||[],paths:r.getPathsByFqPath(t&&t.context_display_path||"",e.viewing_user.id,!0),order:c(e.activity_key),idType:e.id_type,resourceId:e.resource_id}}catch(t){return n.defer(function(){return i.errorActions.recentActivityParseError(e.activity_key,t)}),null}}Object.defineProperty(t,"__esModule",{value:!0});var a=0,c=n.memoize(function(e){return a+=1});t.convertRecentActivityToRecentItem=o}),define("modules/clean/recent_activity/models/utils",["require","exports","external/lodash","modules/clean/browse_uri_interface","modules/clean/recent_activity/recent_activity_constants","modules/clean/viewer"],function(e,t,n,i,r,o){"use strict";function a(e){var t=n.values(e.filter_types_by_key);return s(t.length,n.uniq(t))}function c(e){return s(e.attachmentIds.length,e.uniqueFilterTypes)}function s(e,t){return!!(e>1&&t.every(function(e){return f.indexOf(e)>=0}))}function l(e){return n.map(e,"id")}function u(e){return e in g}function d(e){return null!==e.type&&u(e.type)}function m(e,t,r){void 0===r&&(r=!1);var a=o.Viewer.get_viewer().get_user_by_id(t);"/"===e&&(e="");var c=[],s=e.split("/");for(r||s.pop();s.length;){var l=n.last(s),u=s.join("/");1===s.length&&""===l&&(l=o.Viewer.get_root_name(a),u="");var d=i.browse_uri_for_fq_path(a,u).toString();c.push({name:l||"",url:d}),s.pop()}return c.reverse()}function _(e,t){return t.when-e.when||e.order-t.order||t.type-e.type}Object.defineProperty(t,"__esModule",{value:!0});var p=r.RECENT_EVENT_FILTER_TYPE.PHOTOS,h=r.RECENT_EVENT_FILTER_TYPE.VIDEOS,E=r.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES,f=[p,h,E];t.shouldShowThumbnailsForSkeletonData=a,t.shouldShowThumbnailsForRecentItem=c,t.extractAttachmentIds=l;var g=(y={},y[r.RECENT_EVENT_TYPES.FILE_SHARED_ADD]=!0,y[r.RECENT_EVENT_TYPES.FILE_SHARED_VIEW]=!0,y);t.isShareLinkEventType=u,t.isShareLinkRecentItem=d,t.getPathsByFqPath=m,t.compareRecentItems=_;var y}),define("modules/clean/recent_activity/react/pending_attachment_list_view",["require","exports","tslib","external/classnames","external/react","external/lodash"],function(e,t,n,i,r,o){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var a=(function(e){function t(){return null!==e&&e.apply(this,arguments)||this}return n.__extends(t,e),t.prototype.render=function(){var e=this.props.count,t=o.times(Math.min(e,4),function(){return r.createElement("li",{className:"attachment-item attachment-item--placeholder"})}),n={"attachment-list":!0,"attachment-list--is-pending":!0,"attachment-list--standalone":1===e};return r.createElement("div",{className:"recents-item__attachments"},r.createElement("ul",{className:i(n)},t))},t})(r.Component);t.PendingAttachmentListView=a}),define("modules/clean/recent_activity/react/recent_activity_container",["require","exports","tslib","external/react","external/classnames","modules/core/i18n","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/react/home/util/show_hide_link","modules/clean/recent_activity/stores/recent_activity_store","modules/clean/react/home/store","modules/clean/react/home/util/logging/timing_component","modules/clean/react/home/util/logging/timing_logger","modules/clean/react/home/util/logging/activity_logger","modules/clean/recent_activity/react/recent_activity_item_container","modules/clean/react/home/constants","modules/clean/react/home/post_tti/api"],function(e,t,n,i,r,o,a,c,s,l,u,d,m,_,p,h){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var E=(function(e){function t(t){var i=e.call(this,t)||this;return i.onShouldLoadMore=function(){var e=s.getRecentActivityStore();if(!i.state.isPending&&i.state.showAll&&!e.didTruncateRecentItems()&&e.didReceiveItemsFromAllStreams()){var t=e.getRecentItems();t.length>i.state.items.length?i.setState({items:t}):a.loadNextPage()&&i.setState({isPending:!0})}},i.handleVisibilityChange=function(){"visible"===document.visibilityState&&a.refreshRecentItems()},i.onUpdateFromStore=function(){return i.setState(i.getStateFromStore())},i.onShowAll=function(){i.setState({showAll:!0})},i.removeStoreListeners=s.getRecentActivityStore().addListener(i.onUpdateFromStore),i.state=n.__assign({},i.getStateFromStore(),{isUnityAvailable:!1,showAll:!1}),i}return n.__extends(t,e),t.prototype.componentDidMount=function(){var e=this;h.waitForHomeTTI().then(function(t){return n.__awaiter(e,void 0,void 0,function(){return n.__generator(this,function(e){switch(e.label){case 0:return t.recentActivityContainerComponentDidMount(this.onShouldLoadMore),[4,t.getUnityFeatures()];case 1:return e.sent()&&this.setState({isUnityAvailable:!0}),[2]}})})}),!this.state.items.length&&s.getRecentActivityStore().didReceiveItemsFromAllStreams()&&this.setState({isPending:!1}),document.addEventListener("visibilitychange",this.handleVisibilityChange,!1)},t.prototype.componentWillUnmount=function(){document.removeEventListener("visibilitychange",this.handleVisibilityChange),this.removeStoreListeners()},t.prototype.getStateFromStore=function(){var e=s.getRecentActivityStore(),t=!e.didReceiveItemsFromAllStreams(),n=e.getRecentItems();if(!t){if(d.homeTimingLogger.logTTData(p.HomeSections.RECENTS)){var i=n.length;i&&m.homeActivityLogger.logRecentsShown(i,!l.getHomeStore().getSectionVisibility()[p.HomeSections.RECENTS])}}return{isPending:t,items:n}},t.prototype.renderLoadingView=function(){return i.createElement("div",{className:"recents-loading-view",key:"loading"},i.createElement("div",{className:"maestro-loading-spinner recents-loading-indicator"}))},t.prototype.renderItems=function(){var e=this.props,t=e.user,n=e.now,o=this.state,a=o.items,c=o.showAll,s=o.isPending,l=o.isUnityAvailable,u={isUnityAvailable:l,user:t,now:n},d=c?a:a.slice(0,10);return i.createElement("ul",{className:"recents-view__sections"},i.createElement("li",{className:"recents-section"},i.createElement("ul",{className:r({"recents-list":!0,"recents-list--is-pending":s&&0===d.length})},d.map(function(e){return i.createElement(_.RecentActivityItemContainer,{key:e.id,recentItem:e,renderingInfo:u})}))))},t.prototype.renderShowMoreLink=function(){var e=this.state,t=e.items,n=e.showAll,r=Math.max(t.length-10,0);return n||!a.hasCursor()&&r<=0?null:i.createElement(c.ShowHideLink,{onClick:this.onShowAll,isExpanded:!1,hiddenItemCount:r,canLoadMore:!0})},t.prototype.renderContent=function(){var e=this.state,t=e.isPending;return e.items.length?[this.renderItems(),t?this.renderLoadingView():null,this.renderShowMoreLink()]:t?[this.renderLoadingView(),this.renderItems()]:i.createElement("div",{className:"recents-empty_state",key:"empty_state"},i.createElement("div",{className:"recents-empty_state_image"}),i.createElement("div",{className:"recents-empty_state_heading"},o._("Items you recently viewed will show up here.")))},t.prototype.render=function(){var e=this.state,t=e.isPending,n=e.items,o=r({"recents-view":!0,"recents-view--is-pending":t&&0===n.length});return i.createElement("div",{className:o},this.renderContent())},t.displayName="RecentActivityContainer",t})(i.PureComponent);t.RecentActivityContainerInner=E,t.RecentActivityContainer=u.timingComponent(E,p.HomeSections.RECENTS)}),define("modules/clean/recent_activity/react/recent_activity_item_actions_view",["require","exports","tslib","external/classnames","external/react","modules/core/i18n","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/actions/recent_activity_action_permissions","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/versions/recent_activity_actions_menu_version_2"],function(e,t,n,i,r,o,a,c,s,l){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var u=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onOpen=function(e){e.preventDefault(),t.getHandler().handleOpen()},t.onDelete=function(e){e.preventDefault(),t.getHandler().handleDelete()},t.onArchive=function(e){e.preventDefault(),t.getHandler().handleArchive()},t.onShareLink=function(e){e.preventDefault(),t.getHandler().handleShare(!0)},t.onDownload=function(e){e.preventDefault(),t.getHandler().handleDownload()},t.onComment=function(e){e.preventDefault(),t.getHandler().handleComment(e)},t.onVersions=function(e){e.preventDefault(),t.props.permissions.versions&&t.getHandler().handleVersions(e)},t}return n.__extends(t,e),t.prototype.getHandler=function(){return this.props.handler},t.prototype.canOpen=function(){return this.props.permissions.open&&this.props.renderingInfo.isUnityAvailable},t.prototype.getDeleteLabel=function(){return this.props.attachmentCount>1?o._("Delete all…"):o._("Delete…")},t.prototype.render=function(){if(c.shouldRenderActionsMenu(this.props.permissions)){var e=i((t={},t["recents-item__more-actions"]=!0,t["recents-item__more-actions--disabled"]=this.props.disableActions,t));return s.isShareLinkEventType(this.props.type)?r.createElement("div",{className:e}):r.createElement("div",{className:e},r.createElement("div",{className:"recents-item__more-actions-button recents-item__action-button",tabIndex:-1},l.renderMoreActionsButton(this)))}return null;var t},t.defaultProps={handler:a.getStubRecentActivityItemContainerHandler(),tooltipHandler:a.getStubRecentActivityTooltipHandler(),attachmentCount:1,disableActions:!1},t})(r.PureComponent);t.RecentActivityItemActionsView=u}),define("modules/clean/recent_activity/react/recent_activity_item_container",["require","exports","tslib","external/lodash","external/react","modules/core/exception","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/react/recent_activity_item_view","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/versions/recent_activity_version_2","modules/clean/react/home/home_access/recents/utils/events","modules/clean/recent_activity/stores/attachment_store"],function(e,t,n,i,r,o,a,c,s,l,u,d,m,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(t){var n=e.call(this,t)||this;return n.onAttachmentStoreChange=function(){n.setState({attachments:_.getAttachmentStore().getByIds(n.getRecentItem().attachmentIds)})},n.handleArchive=function(){d.RecentActivityVersion2.archiveRecentItem(n.getRecentItem(),n.getLogData())},n.handleComment=function(e){var t=n.getSingleAttachment("handleComment only supports a single attachment"),i=Math.max(0,n.state.attachments.indexOf(t));n.previewOrOpenFiles({event:e,index:i,shouldFocusCommentInput:!0})},n.handleDelete=function(){d.RecentActivityVersion2.deleteRecentItem(n.getRecentItem(),n.state.attachments,n.getLogData())},n.handleDownload=function(){var e=n.getSingleAttachment("handleDownload only supports a single attachment");c.downloadFiles([e.id],n.getLogData())},n.handleHeaderClick=function(){var e=n.state,t=e.isCollapsed,i=e.attachments;if(n.getRecentItem().uniqueFilterTypes.length>1){var r=t?a.ActionTypes.UNCOLLAPSE:a.ActionTypes.COLLAPSE;m.logEvent(r,n,n.getAttachmentFqPaths(),i.length)}n.setState({isCollapsed:!t})},n.handleOpen=function(){var e=n.getSingleAttachment("handleOpen only supports a single attachment");c.openFile(e.id,n.getLogData())},n.handlePathClick=function(e){var t=n.getAttachmentFqPaths();l.logOpenPathUrl(n.props.recentItem.viewingUserId,t,n.props.recentItem.attachmentIds.length,n),d.RecentActivityVersion2.handlePathClick(e,n.getRecentItem(),n.getLogData())},n.handlePreview=function(e){n.previewOrOpenFiles({event:e,shouldFocusCommentInput:!1})},n.handleShare=function(e){d.RecentActivityVersion2.shareRecentItem(n.getRecentItem(),n.state.attachments,n.getLogData(),e)},n.handleVersions=function(e){var t=n.getSingleAttachment("handleVersions only supports a single attachment");c.openVersions(t.id,e,n.getLogData())},n.removeStoreListeners=null,n.state={attachments:[],isCollapsed:!0},n}return n.__extends(t,e),t.prototype.getRecentItem=function(){return this.props.recentItem},t.prototype.getLogData=function(){return{totalCount:this.props.recentItem.attachmentIds.length,cellView:this}},t.prototype.getAttachmentFqPaths=function(){return i.compact(i.map(this.state.attachments,"fqPath"))},t.prototype.getSingleAttachment=function(e){return e&&o.assert(1===this.state.attachments.length,e),this.state.attachments[0]},t.prototype.previewOrOpenFiles=function(e){var t=this.props.recentItem;d.RecentActivityVersion2.previewRecentItem(t,n.__assign({},e,{shouldUseEntityUri:u.isShareLinkRecentItem(t)}),this.getLogData())},t.prototype.componentWillMount=function(){this.removeStoreListeners=_.getAttachmentStore().addListener(this.onAttachmentStoreChange),this.onAttachmentStoreChange()},t.prototype.componentWillUnmount=function(){this.removeStoreListeners&&this.removeStoreListeners()},t.prototype.render=function(){return r.createElement(s.RecentActivityItemView,{recentItem:this.getRecentItem(),attachments:this.state.attachments,handler:this,isCollapsed:this.state.isCollapsed,renderingInfo:this.props.renderingInfo})},t.displayName="RecentActivityItemContainer",t})(r.PureComponent);t.RecentActivityItemContainer=p}),define("modules/clean/recent_activity/react/recent_activity_item_header_view",["require","exports","tslib","external/classnames","external/react","external/spectrum/icon_arrow","modules/clean/accessibility/utils","modules/clean/react/helpers","modules/clean/react/home/constants","modules/clean/react/home/util/resource_icon","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/recent_activity_view_helper"],function(e,t,n,i,r,o,a,c,s,l,u,d){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var m=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.onClick=function(e){e.stopPropagation(),e.preventDefault(),t.props.handleClick(e)},t}return n.__extends(t,e),t.prototype.getHeaderProps=function(){return this.props.header},t.prototype.renderIcon=function(){var e=this.getHeaderProps(),t=e.isAggregation,n=e.displayType,i=e.fileName;return r.createElement("div",{className:"recents-item__icon"},r.createElement("span",{className:"file-icon file-icon--sprite file-icon--spectrum"},r.createElement(l.HomeResourceIcon,{className:"file-icon__img",displayType:t?s.DisplayTypes.AGGREGATION:n||s.DisplayTypes.FILE,variant:"small",fileName:i||""})))},t.prototype.renderHeading=function(){return r.createElement("a",n.__assign({ref:"heading",className:"recents-item__heading"},a.accessibleTriggerProps(this.props.handleClick)),this.getHeaderProps().heading)},t.prototype.renderSubheading=function(){var e=this.getHeaderProps().subheading;return e?r.createElement("div",{ref:"subheading",className:"recents-item__subheading"},e):null},t.prototype.renderDetails=function(){return r.createElement("div",{ref:"recentsItemDetails",className:"recents-item__details"},r.createElement("div",{className:"recents-item__heading-group"},this.renderHeading(),this.renderStar()),this.renderSubheading())},t.prototype.renderStar=function(){var e=this.getHeaderProps().star;return e?r.createElement("div",{className:"item__star"},e):null},t.prototype.renderActions=function(){var e=this.props,t=e.recentActivityType,n=e.children,o=e.tooltipShown;if(t&&u.isShareLinkEventType(t)||0===r.Children.count(n))return null;var a=i((c={},c["recents-item__actions-inner"]=!0,c["recents-item__actions-inner--tooltip-shown"]=o,c));return r.createElement("div",{ref:"actions",className:"recents-item__actions"},r.createElement("div",{className:a},n));var c},t.prototype.renderCarat=function(){var e=this.getHeaderProps(),t=e.isAggregation,n=e.isCollapsed;if(!t)return null;var a=i({"recents-item__carat":!0,"recents-item__carat--expanded":!n});return r.createElement("div",{className:a},r.createElement(o.IconArrow,{name:"right"}))},t.prototype.shouldComponentUpdate=function(e,t){return c.compareStateAndProps(e,t)},t.prototype.render=function(){return r.createElement("div",{className:"recents-item__wrapper",onClick:d.ensureUserIntentToClick(this.onClick)},this.renderCarat(),this.renderIcon(),this.renderDetails(),this.renderActions())},t.defaultProps={handleClick:function(e){return null},tooltipShown:!1},t})(r.PureComponent);t.RecentActivityItemHeaderView=m}),define("modules/clean/recent_activity/react/recent_activity_item_view",["require","exports","tslib","external/classnames","external/react","external/lodash","modules/core/exception","modules/core/i18n","modules/clean/em_string","modules/clean/datetime","modules/clean/react/helpers","modules/clean/recent_activity/actions/recent_activity_action_permissions","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/recent_activity_rendering_models","modules/clean/recent_activity/recent_activity_view_helper","modules/clean/recent_activity/recent_activity_text_helper","modules/clean/recent_activity/react/pending_attachment_list_view","modules/clean/recent_activity/versions/recent_activity_version_2","modules/clean/recent_activity/react/recent_activity_item_header_view","modules/clean/react/home/util/conditional_api","modules/clean/react/title_bubble","modules/clean/react/starred/constants","modules/clean/recent_activity/react/recent_activity_item_actions_view","modules/clean/react/home/util/experiment_hook","modules/clean/react/home/post_tti/api"],function(e,t,n,i,r,o,a,c,s,l,u,d,m,_,p,h,E,f,g,y,v,T,I,R,S,A){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.experimentOverride=S.experimentOverride,t.ImageAttachments=A.PostHomeTTIComponent({preTTIRenderer:function(e){var t=e.count;return r.createElement(f.PendingAttachmentListView,{count:t})},getPostTTIRenderer:function(e){var t=e.AttachmentListView;return function(e){var n=e.attachments;return r.createElement(t,{attachments:n})}}});var C=(function(e){function S(t){var n=e.call(this,t)||this;return n.onDisabled=function(e){e.preventDefault()},n.handleMouseEnter=function(){n.setState({isHovered:!0})},n.handleMouseLeave=function(){n.setState({isHovered:!1})},n.onShare=function(e){e.preventDefault(),n.props.handler.handleShare()},n.onShowTooltip=function(){n.setState({tooltipShown:!0})},n.onHideTooltip=function(){n.setState({tooltipShown:!1})},n.state={tooltipShown:!1,isHovered:!1},n}return n.__extends(S,e),S.prototype.shouldDisableActions=function(){var e=this.props.recentItem.federatedRecentItem;return e?!e.hasMenuActions():!this.hasLoadedAttachments()},S.prototype.isAggregation=function(){return this.props.recentItem.attachmentIds.length>1},S.prototype.shouldShowThumbnails=function(){var e=this.props.recentItem;return!_.isShareLinkRecentItem(e)&&_.shouldShowThumbnailsForRecentItem(e)},S.prototype.getLoadedAttachmentsCount=function(){return this.props.attachments.filter(function(e){return e.isLoaded}).length},S.prototype.canRenderAttachmentView=function(){var e=this.getLoadedAttachmentsCount()
;return e===this.props.recentItem.attachmentIds.length||e>=m.MAX_INITIAL_THUMBNAIL_ATTACHMENTS},S.prototype.hasLoadedAttachments=function(){return!(!this.props.attachments.length||!this.getLoadedAttachmentsCount())},S.prototype.getHeading=function(){var e=this.props,t=e.attachments,n=e.recentItem;if(t.length<2)return s.Emstring.em_snippet(n.displayName||"",30);for(var i=n.attachmentIds.length,r=n.uniqueFilterTypes,o=[],a=0,l=t;a<l.length;a++){var u=l[a];u.isLoaded&&u.displayName&&o.push(u.displayName)}switch(r.length){case 1:switch(r[0]){case m.RECENT_EVENT_FILTER_TYPE.PHOTOS:return c.ungettext("%(count)s image","%(count)s images",i).format({count:i});case m.RECENT_EVENT_FILTER_TYPE.VIDEOS:return c.ungettext("%(count)s video","%(count)s videos",i).format({count:i});case m.RECENT_EVENT_FILTER_TYPE.VISUAL_NOTES:return c.ungettext("%(count)s visual note","%(count)s visual notes",i).format({count:i})}break;case 2:if(r.indexOf(m.RECENT_EVENT_FILTER_TYPE.PHOTOS)>=0&&r.indexOf(m.RECENT_EVENT_FILTER_TYPE.VIDEOS)>=0)return c._("%(count)s images and videos").format({count:i})}return o.length?E.snippetList(o,30,{totalCount:i}):c.ungettext("%(count)s file","%(count)s files",i).format({count:i})},S.prototype.getParentPathComponent=function(){var e=this.props.recentItem,t=e.type,n=e.paths;if(_.isShareLinkRecentItem(e)&&t===m.RECENT_EVENT_TYPES.FILE_SHARED_ADD)return{name:c._("Your links"),url:"/links/your_links"};if(n.length){var i=o.last(n);if(i.url)return i}return null},S.prototype.renderAction=function(){switch(this.props.recentItem.type){case m.RECENT_EVENT_TYPES.FILE_ADD:case m.RECENT_EVENT_TYPES.PAPER_ADD:return m.I18N.CREATED;case m.RECENT_EVENT_TYPES.FILE_EDIT:case m.RECENT_EVENT_TYPES.PAPER_EDIT:return m.I18N.EDITED;default:return m.I18N.OPENED}},S.prototype.getSubheading=function(){var e=this.getParentPathComponent(),t=this.props,n=t.renderingInfo,i=t.recentItem,o=t.handler,a=new Date(i.when);return r.createElement("div",{className:"recents-item__subheading"},this.renderAction()+" ",r.createElement(T.TitleBubble,{position:T.TitleBubble.POSITIONS.TOP,content:r.createElement("div",{className:"recents-item__subheading-time-tooltip"},l.format_date(a,"MMM d, yyyy")+"\n"+l.format_date(a,l.localized_time_format))},r.createElement("div",{className:"recents-time__subheading-time"},l.agoFromDate(a,n.now,!1,!0))),e?" · ":"",e?r.createElement("a",{className:"recents-item__subheading-parent",href:e.url,onClick:o.handlePathClick},e.name):null)},S.prototype.renderShareButton=function(){var e=this.props.recentItem,t=g.RecentActivityVersion2.getShareButtonVisibility(e,this.hasLoadedAttachments());if(t!==m.RecentElementVisibilities.HIDDEN){var n=i({disabled:t===m.RecentElementVisibilities.DISABLED,"button-secondary":!0,"recents-item__share-link":!0});return r.createElement("a",{ref:"shareLink",className:n,href:"#share",onClick:t===m.RecentElementVisibilities.SHOWN?this.onShare:this.onDisabled},c._("Share"))}return null},S.prototype.renderAttachments=function(){var e=this.props,n=e.recentItem,i=e.attachments;if(this.shouldShowThumbnails()){if(this.props.isCollapsed)return null;var o=n.attachmentIds.length;return this.canRenderAttachmentView()?r.createElement(t.ImageAttachments,{attachments:i,count:o}):r.createElement(f.PendingAttachmentListView,{count:o})}return this.isAggregation()&&a.reportStack("Tried to render non-photo aggregation but failed",{severity:a.SEVERITY.NONCRITICAL,exc_extra:{recent_item:n,attachments:i}}),null},S.prototype.renderButton=function(e){return e.share?r.createElement("div",{className:"recents-item__sharing recents-item__action-button"},this.renderShareButton()):null},S.prototype.renderStar=function(){var e=this.props,t=e.recentItem,n=e.renderingInfo;return v.waitForStarred(function(e){var i=e.Star,o=e.getIdTypePairFromRecentItem,a=o(t);return a?r.createElement(i,{id:a.id,idType:a.type,user:n.user,source:I.StarredSource.HOME_RECENTS}):null},!1)},S.prototype.getHeaderProps=function(){var e=this.props,t=e.recentItem,n=e.isCollapsed,i=e.attachments,r=t.displayName,o=t.displayType;return{heading:this.getHeading(),subheading:this.getSubheading(),thumbnailUrl:1===i.length&&i[0].thumbnailUrl||void 0,star:this.renderStar(),fileName:r,isAggregation:this.isAggregation(),displayType:o,isCollapsed:n}},S.prototype.renderHeader=function(){var e=this.props,t=e.recentItem,n=e.attachments,i=e.handler,o=e.renderingInfo,a=d.getRecentActivityItemViewPermissions(t,n);return r.createElement(y.RecentActivityItemHeaderView,{ref:"header",header:this.getHeaderProps(),handleClick:this.isAggregation()?i.handleHeaderClick:i.handlePreview,tooltipShown:this.state.tooltipShown,recentActivityType:t.type},this.renderButton(a),r.createElement(R.RecentActivityItemActionsView,{ref:"recentsItemActionsView",handler:i,tooltipHandler:this,type:t.type,permissions:a,attachmentCount:t.attachmentIds.length,disableActions:this.shouldDisableActions(),rowIsHovered:this.state.isHovered,renderingInfo:o}))},S.prototype.shouldComponentUpdate=function(e,t){return u.compareStateAndProps(e,t)},S.prototype.render=function(){var e=this.props,t=e.recentItem,n=e.handler,o=i((c={},c["recents-item"]=!0,c["recents-item--loaded"]=this.hasLoadedAttachments(),c)),a=_.isShareLinkRecentItem(t)&&this.isAggregation()?void 0:h.ensureUserIntentToClick(n.handlePreview);return r.createElement("li",{"data-item-id":t.id,"data-item-type":t.type,"data-item-date":t.when,className:o,onClick:a,onMouseEnter:this.handleMouseEnter,onMouseLeave:this.handleMouseLeave},this.renderHeader(),this.renderAttachments());var c},S.displayName="RecentActivityItemView",S.defaultProps={handler:p.getStubRecentActivityItemContainerHandler(),isCollapsed:!0,attachments:[]},S})(r.PureComponent);t.RecentActivityItemView=C}),define("modules/clean/recent_activity/recent_activity_client",["require","exports","tslib","modules/clean/react/home/api"],function(e,t,n,i){"use strict";function r(e,t,n,r){return void 0===r&&(r=!0),i.makeRequest({subject_user:e,type:"POST",url:t,data:n},{isBackground:r})}function o(e,t,i,o){return void 0===o&&(o=!0),n.__awaiter(this,void 0,void 0,function(){var c;return n.__generator(this,function(n){switch(n.label){case 0:return c=a,[4,r(e,t,i,o)];case 1:return[2,c.apply(void 0,[n.sent()])]}})})}function a(e){if("ok"===e.status)return e.payload;throw new Error("Payload not okay: "+JSON.stringify(e))}function c(e,t){return r(e,"/recents/json",{num_activities:t?20:10,cursor:t})}function s(e,t){return n.__awaiter(this,void 0,void 0,function(){return n.__generator(this,function(n){switch(n.label){case 0:return[4,r(e,"/home_feed/retrieve_paper_recents",{is_initial_fetch:t})];case 1:return[2,n.sent()]}})})}function l(e,t){i.makeRequest({url:"/recents/logger",type:"POST",subject_user:e,data:t,dataType:"text"},{isBackground:!0})}function u(e,t){return o(e,"/home_feed/archive_paper_resources",{resources_json:JSON.stringify(t)},!1)}Object.defineProperty(t,"__esModule",{value:!0}),t.fetchPayload=o,t.getPayload=a,t.recentsJson=c,t.retrievePaperRecents=s,t.postLogEvent=l,t.archivePaperResources=u}),define("modules/clean/recent_activity/recent_activity_constants",["require","exports","modules/constants/python","modules/core/i18n"],function(e,t,n,i){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.RECENT_EVENT_TYPES=n.RECENT_EVENT_TYPES,t.RECENT_EVENT_FILTER_TYPE=n.RECENT_EVENT_FILTER_TYPE,t.ARCHIVE_PAPER_DOCUMENT_COMMIT="ARCHIVE_PAPER_DOCUMENT_COMMIT",t.ARCHIVE_PAPER_DOCUMENT_PENDING="ARCHIVE_PAPER_DOCUMENT_PENDING",t.ARCHIVE_PAPER_DOCUMENT_ROLLBACK="ARCHIVE_PAPER_DOCUMENT_ROLLBACK",t.DELETE_FILES_COMMIT="DELETE_FILES_COMMIT",t.DELETE_FILES_PENDING="DELETE_FILES_PENDING",t.DELETE_FILES_ROLLBACK="DELETE_FILES_ROLLBACK",t.RAW_RECENT_ACTIVITY_PARSE_ERROR="RAW_RECENT_ACTIVITY_PARSE_ERROR",t.RAW_RELATED_ACTIVITY_PARSE_ERROR="RAW_RELATED_ACTIVITY_PARSE_ERROR",t.RECEIVE_CAN_OPEN_INFO="RECEIVE_CAN_OPEN_INFO",t.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO="RECEIVE_FILE_IN_ROOT_COLLECTION_INFO",t.RECEIVE_PAPER_RECENT_ITEMS="RECEIVE_PAPER_RECENT_ITEMS",t.RECEIVE_RAW_RECENT_ACTIVITIES="RECEIVE_RAW_RECENT_ACTIVITIES",t.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY="RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY",t.REFRESH_RECENT_ACTIVITIES="REFRESH_RECENT_ACTIVITIES",t.ADD_PENDING_ACTIVITY_KEYS="ADD_PENDING_ACTIVITY_KEYS",t.REMOVE_PENDING_ACTIVITY_KEYS="REMOVE_PENDING_ACTIVITY_KEYS",t.MAX_INITIAL_DOC_ATTACHMENTS=3,t.SHOW_MORE_DOC_ATTACHMENT_INCREMENT=10,t.MAX_INITIAL_THUMBNAIL_ATTACHMENTS=8,t.SHOW_MORE_THUMBNAIL_ROW_INCREMENT=4;(function(e){e.CREATED="CREATE",e.OPENED="VIEW",e.EDITED="EDIT"})(t.PaperRecentItemAction||(t.PaperRecentItemAction={})),t.PaperRecentItemTypes={DOCUMENT:"DOCUMENT",FOLDER:"FOLDER",PROJECT:"PROJECT"},t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI=10,t.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI=100,t.FederatedOrigins={PAPER:"PAPER"},t.RecentElementVisibilities={SHOWN:"SHOWN",HIDDEN:"HIDDEN",DISABLED:"DISABLED"},t.MAX_ENSURE_ATTACHMENT_LOAD_ATTACHMENTS_ATTEMPTS=1,t.I18N={CREATED:i._("Created"),EDITED:i._("Edited"),OPENED:i._("Opened")}}),define("modules/clean/recent_activity/recent_activity_dispatcher",["require","exports","external/flux"],function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.recentActivityDispatcher=new n.Dispatcher}),define("modules/clean/recent_activity/recent_activity_federated_model",["require","exports","modules/clean/recent_activity/recent_activity_constants"],function(e,t,n){"use strict";function i(e){return e.paperRecentItem.type===n.PaperRecentItemTypes.DOCUMENT}function r(e){return e.paperRecentItem.type===n.PaperRecentItemTypes.PROJECT}function o(e){return i(e)?e.paperRecentItem.shareUrl||"":""}function a(e,t){return e.paperRecentItem.id===t.id&&e.paperRecentItem.type===t.type}Object.defineProperty(t,"__esModule",{value:!0}),t.isPaperDocument=i,t.isPaperProject=r,t.getPaperShareUrl=o,t.equalsPaperRecentItem=a;var c=(function(){function e(e){this.paperRecentItem=e}return e.prototype.isShareable=function(){return i(this)&&!!o(this)},e.prototype.isArchiveable=function(){return i(this)&&!!this.paperRecentItem.isEditable},e.prototype.hasMenuActions=function(){return this.isArchiveable()},e.prototype.getIdTypePair=function(){return{id:this.paperRecentItem.resource_id,type:this.paperRecentItem.id_type}},e.prototype.getStarredStatus=function(){return{starred:this.paperRecentItem.isFavorite,idTypePair:this.getIdTypePair()}},e.prototype.getIcon=function(){switch(this.paperRecentItem.display_type){case"PAPER_DOCUMENT":return"paper_doc";case"PAPER_FOLDER":return"folder";case"PAPER_PUBLIC_FOLDER":return"folder_team";case"PAPER_PROJECT":return"paper_project";default:return"file"}},e.prototype.getFolderPath=function(){return[""].concat(this.paperRecentItem.path.map(function(e){return e.name})).join("/")},e.prototype.getFqPath=function(){return this.getFolderPath()+"/"+this.paperRecentItem.name},e.prototype.getActivityKey=function(){return"paper_id_"+this.paperRecentItem.id},e.prototype.getUrl=function(){return this.paperRecentItem.url},e})();t.FederatedRecentItem=c}),define("modules/clean/recent_activity/recent_activity_logger",["require","exports","tslib","external/lodash","modules/clean/recent_activity/recent_activity_client","modules/core/exception"],function(e,t,n,i,r,o){"use strict";function a(e,t,i){if(void 0===i&&(i={}),g){var o=n.__assign({},i,{event_name:t});r.postLogEvent(e,o)}}function c(e,t,n){var r=Object.keys(n),a=i.difference(r,t);o.assert(0===a.length,e+" called with unsupported keys: "+a)}function s(){g=!0}function l(){g=!1}function u(e,t){c("logPageLoaded",p,t),a(e,"client_page_loaded",t)}function d(e,t){c("logRequestFailed",h,t),a(e,"request_failed",t)}function m(e,t){c("logCellAction",E,t),a(e,"cell_action",t)}function _(e,t){c("logTimeToFirstAction",f,t),a(e,"time_to_first_action",t)}Object.defineProperty(t,"__esModule",{value:!0});t.ActionScopes={SINGLE:"single",SUBSET:"subset",AGGREGATION:"aggregation"},t.ActionTypes={VIEW_FILE:"view",OPEN:"open",SHARE:"share",SHARE_COLLECTION:"share_collection",DELETE:"delete",HIDE:"hide",UNITY_OPEN:"unity_open",OPEN_DIR:"open_dir",OPEN_PATH:"open_path",REPORT_JUNK:"report_junk",COMMENT:"comment",DOWNLOAD:"download",VERSIONS:"versions",VIEW_SHARED_LINK:"view_shared_link",PAPER_ARCHIVE:"paper_archive",PAPER_OPEN:"paper_open",PAPER_SHARE:"paper_share",COLLAPSE:"collapse",UNCOLLAPSE:"uncollapse",ONBOARDING_DISMISSED:"onboarding_dismissed",FULL_ONBOARDING_OPENED:"full_onboarding_opened",FULL_ONBOARDING_DISMISSED:"full_onboarding_dismissed"},t.FilterViews={EVERYTHING:"everything"};var p=["is_full_page","item_count","contains_aggregation","latency","is_paginated"],h=["failure_type","is_paginated"],E=["in_aggregation","filter_view","action_type","target_activity_type","action_scope","position","file_extension","days_ago"],f=["latency","action_type","action_scope"],g=!0;t.enableLogging=s,t.disableLogging=l,t.logPageLoaded=u,t.logRequestFailed=d,t.logCellAction=m,t.logTimeToFirstAction=_}),define("modules/clean/recent_activity/recent_activity_logger_utils",["require","exports","tslib","external/react-dom","external/lodash","modules/clean/react/home/home_access/recents/utils/events","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/stores/attachment_store","modules/clean/web_timing_logger","modules/clean/react/home/util/navigation"],function(e,t,n,i,r,o,a,c,s,l){"use strict";function u(e){return Math.floor((Date.now()-e)/864e5)}function d(e,t,n,o,c){var s=i.findDOMNode(c);if(null!==s){var l,d=r.filter(r.uniq(r.map(n,function(e){return null!=e?e.split(".").pop().toLowerCase():void 0})),Boolean),_=o>1;l=1===o?a.ActionScopes.SINGLE:n.length===o?a.ActionScopes.AGGREGATION:a.ActionScopes.SUBSET;var p=Array.prototype.indexOf.call(s.parentNode.childNodes,s),h=Number(s.getAttribute("data-item-type")),E=Number(s.getAttribute("data-item-date")),f={in_aggregation:_,filter_view:a.FilterViews.EVERYTHING,action_type:e,action_scope:l,target_activity_type:h,position:p,file_extension:d.join(","),days_ago:u(E)};a.logCellAction(t,f),m(t,r.pick(f,"action_scope","action_type"))}}function m(e,t){if(!v){var i=s.start_time();i&&(v=!0,a.logTimeToFirstAction(e,n.__assign({},t,{latency:Date.now()-i})))}}function _(e){return function(t,n,i,r){d(e,t,n,i,r)}}function p(e){return function(t,n,i,r){return _(e)(t,[n],i,r)}}function h(e,t){a.logRequestFailed(e,{failure_type:t?t.status:-1,is_paginated:!1})}function E(){var e=Date.now(),t=!1;if(!T){var i=s.start_time();i&&(t=!0,e=i,T=!0)}return function(i,r){void 0===r&&(r={});var o=n.__assign({is_full_page:t},r,{latency:Date.now()-e});a.logPageLoaded(i,o)}}function f(){T=v=!1}function g(e,t,n){var i=r.map(c.getAttachmentStore().getByIds(t),"fqPath").filter(Boolean);return o.logEvent(e,n.cellView,i,n.totalCount)}function y(e,t,n,i){l.logAndNavigate(e,function(){return g(t,n,i)},l.NavigationMethod.NEW_TAB)}Object.defineProperty(t,"__esModule",{value:!0});var v=!1,T=!1;t.logShareFile=p(a.ActionTypes.SHARE),t.logPreviewFiles=_(a.ActionTypes.VIEW_FILE),t.logDeleteFiles=_(a.ActionTypes.DELETE),t.logUnityOpenFile=p(a.ActionTypes.UNITY_OPEN),t.logOpenPathUrl=_(a.ActionTypes.OPEN_DIR),t.logOpenSharedLinkUrl=_(a.ActionTypes.VIEW_SHARED_LINK),t.logCommentFile=p(a.ActionTypes.COMMENT),t.logDownloadFile=_(a.ActionTypes.DOWNLOAD),t.logOpenVersions=p(a.ActionTypes.VERSIONS),t.logRequestFailed=h,t.startRequestTimer=E,t.reset=f,t.logRecentActivityAction=g,t.openTab=y}),define("modules/clean/recent_activity/recent_activity_rendering_models",["require","exports"],function(e,t){"use strict";function n(){return{handleArchive:function(){},handleComment:function(e){},handleDelete:function(){},handleDownload:function(){},handleHeaderClick:function(){},handleOpen:function(){},handlePathClick:function(){},handlePreview:function(e){},handleShare:function(){},handleVersions:function(e){}}}function i(){return{onShowTooltip:function(){},onHideTooltip:function(){}}}Object.defineProperty(t,"__esModule",{value:!0}),t.getStubRecentActivityItemContainerHandler=n,t.getStubRecentActivityTooltipHandler=i}),define("modules/clean/recent_activity/recent_activity_stream",["require","exports","external/lodash","modules/clean/recent_activity/models/utils"],function(e,t,n,i){"use strict";function r(e){var t=e.filter(Boolean),r=n.max(t.map(function(e){return e.oldestTimeForOtherStream}));return(o=[]).concat.apply(o,t.map(function(e){return e.getItemsAfter(r)})).sort(i.compareRecentItems);var o}Object.defineProperty(t,"__esModule",{value:!0});var o=(function(){function e(e,t){var n=this;this.sortedRecentItems=e,this.hasMore=t,this.activityKeyToRecentItem={},e.forEach(function(e){n.activityKeyToRecentItem[e.id]=e}),this.oldestTimeForOtherStream=this.getOldestItemTimeForOtherStreams()}return e.prototype.getOldestItemTimeForOtherStreams=function(){return this.hasMore&&this.sortedRecentItems.length?this.sortedRecentItems[this.sortedRecentItems.length-1].when||0:0},e.prototype.getRecentItems=function(){return this.sortedRecentItems.slice()},e.prototype.getRecentItemByActivityKey=function(e){return this.activityKeyToRecentItem[e]||null},e.prototype.getStreamWithoutActivityKey=function(t){return new e(this.sortedRecentItems.filter(function(e){return e.id!==t}),this.hasMore)},e.prototype.getItemsAfter=function(e){if(this.oldestTimeForOtherStream<e){for(var t=[],n=0,i=this.sortedRecentItems;n<i.length;n++){var r=i[n];if(r.when<e)break;t.push(r)}return t}return this.sortedRecentItems},e})();t.RecentActivityStream=o,t.getMergedRecentItems=r}),define("modules/clean/recent_activity/recent_activity_text_helper",["require","exports","modules/clean/em_string","modules/core/i18n"],function(e,t,n,i){"use strict";function r(e,t){return i.ungettext("%(name)s and %(num)s other","%(name)s and %(num)s others",t).format({name:e,num:t})}function o(e,t,o){void 0===o&&(o={});var a=Math.max(Math.floor(o.totalCount||0),e.length);if(1===a)return n.Emstring.em_snippet(e[0],t);var c=e[0],s=a-1,l=r(c,s);if(new n.Emstring(l).length>t){var u=Math.floor(t-new n.Emstring(r("",s)).length)-1;l=u<3?i.ungettext("%(num)s other","%(num)s others",a).format({num:a}):r(n.Emstring.em_snippet(c,u),s)}for(var d="",m=1;m<e.length&&(m+=1,d=e.slice(0,m).join(", "),m<a&&(d=r(d,a-m)),new n.Emstring(d).length<t);)l=d;return l}Object.defineProperty(t,"__esModule",{value:!0}),t.snippetList=o}),define("modules/clean/recent_activity/recent_activity_view_helper",["require","exports"],function(e,t){"use strict";function n(e){return function(t){if(!window.getSelection().toString()){for(var n=t.target;n&&n.parentNode&&n!==t.currentTarget;){if(["a","button"].indexOf(n.nodeName.toLowerCase())>=0)return;n=n.parentNode}e.apply(this,arguments)}}}Object.defineProperty(t,"__esModule",{value:!0}),t.ensureUserIntentToClick=n}),define("modules/clean/recent_activity/store_utils",["require","exports","tslib","modules/clean/react/home/store","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/recent_activity_logger_utils","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/models/utils","modules/clean/react/home/post_tti/api"],function(e,t,n,i,r,o,a,c,s,l){"use strict";function u(e){var t=this;return _(function(){return n.__awaiter(t,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return t=d,[4,a.recentsJson(i.getUserId(),e)];case 1:return[2,t.apply(void 0,[n.sent(),!e])]}})})})}function d(e,t){var u=this;return void 0===t&&(t=!0),m(function(){var d=o.startRequestTimer(),m=a.getPayload(e),p=m.recent_activities,h=m.cursor,E=m.encrypted,f=i.getUserId();return r.recentActivityDispatcher.dispatch({type:c.RECEIVE_RAW_RECENT_ACTIVITIES,rawRecentActivities:p,cursor:h||"",encrypted:E||"",userId:f}),_(function(){return n.__awaiter(u,void 0,void 0,function(){var e,i,r;return n.__generator(this,function(n){switch(n.label){case 0:return e=[],p.forEach(function(t){if(t.skeleton_data&&t.related_activity_keys){var n=s.shouldShowThumbnailsForSkeletonData(t.skeleton_data)?c.MAX_INITIAL_THUMBNAIL_ATTACHMENTS:c.MAX_INITIAL_DOC_ATTACHMENTS;e=e.concat.apply(e,t.related_activity_keys.slice(0,n))}}),[4,l.waitForHomeTTI()];case 1:return[4,n.sent().ensureAttachments(e,"handleAndLogRecentsJsonPromise")];case 2:return n.sent(),i=!1,r=0,p.forEach(function(e){var t=e.skeleton_data;t&&(r+=t.num_related_activities||0,(t.num_related_activities||0)>1&&(i=!0))}),d(f,{is_paginated:!t,contains_aggregation:i,item_count:r}),[2]}})})})})}function m(e){try{return e()}catch(e){throw o.logRequestFailed(i.getUserId(),e),e}}function _(e){return n.__awaiter(this,void 0,void 0,function(){var t;return n.__generator(this,function(n){switch(n.label){case 0:return n.trys.push([0,2,,3]),[4,e()];case 1:return[2,n.sent()];case 2:throw t=n.sent(),o.logRequestFailed(i.getUserId(),t),t;case 3:return[2]}})})}function p(e){return n.__awaiter(this,void 0,void 0,function(){var t,r;return n.__generator(this,function(n){switch(n.label){case 0:return t=a.retrievePaperRecents(i.getUserId(),e),r=h,[4,t];case 1:return r.apply(void 0,[n.sent(),e]),[2]}})})}function h(e,t){void 0===t&&(t=!0);var n=i.getUserId(),o=a.getPayload(e),s=t&&o.has_more;r.recentActivityDispatcher.dispatch({type:c.RECEIVE_PAPER_RECENT_ITEMS,items:o.items,hasMore:s,userId:n}),s&&l.waitForHomeTTI().then(function(){return p(!1)})}Object.defineProperty(t,"__esModule",{value:!0}),t.loadRecentItems=u,t.handleAndLogRecentsJsonPromise=d,t.loadPaperRecentItems=p,t.handleRetrievePaperRecentsPromise=h}),define("modules/clean/recent_activity/stores/attachment_store",["require","exports","tslib","modules/clean/flux/dispatcher","modules/clean/react/home/constants","external/lodash","modules/clean/flux/flux_store","modules/clean/recent_activity/actions/error_actions","modules/clean/recent_activity/stores/flux_utils","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/models/attachment","modules/core/exception"],function(e,t,n,i,r,o,a,c,s,l,u,d,m){"use strict";function _(){return null===h&&(h=new p(u.recentActivityDispatcher)),h}Object.defineProperty(t,"__esModule",{value:!0});var p=(function(e){function t(t,n){void 0===n&&(n={});var i=e.call(this,t)||this;return i.onCommit=function(e){delete i.transactionHistory[e.transactionId]},i._onDeleteFilesPending=function(e){for(var t=[],n=0,r=e.attachmentIds;n<r.length;n++){var o=r[n];o in i.attachmentIdToAttachment&&(t.push(i.attachmentIdToAttachment[o]),delete i.attachmentIdToAttachment[o])}i.transactionHistory[e.transactionId]={deletedAttachments:t},s.emitChangeIfNeeded(i,!!t.length)},i._onDeleteFilesRollback=function(e){var t=i.transactionHistory[e.transactionId];m.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),t.deletedAttachments.forEach(function(e){return i.attachmentIdToAttachment[e.id]=e}),s.emitChangeIfNeeded(i,!!t.deletedAttachments.length)},i.pendingActivityKeys=[],i.attachmentIdToEncryptedToken={},i.attachmentIdToAttachment={},(n.attachments||[]).forEach(function(e){i.attachmentIdToAttachment[e.id]=e,n.encryptedToken&&(i.attachmentIdToEncryptedToken[e.id]=n.encryptedToken)}),i.transactionHistory={},i}return n.__extends(t,e),t.prototype.areSomeActivityKeysPending=function(e){return!!o.intersection(this.pendingActivityKeys,e).length},t.prototype.getById=function(e){return this.attachmentIdToAttachment[e]||null},t.prototype.getByIds=function(e){return o.values(o.pick(this.attachmentIdToAttachment,e))},t.prototype.getByFqPath=function(e){return this.getAll().find(function(t){return t.fqPath===e})||null},t.prototype.getAll=function(){return o.values(this.attachmentIdToAttachment)},t.prototype.groupIdsByEncryptedToken=function(e){var t=this;return o.groupBy(e.filter(function(e){return e in t.attachmentIdToEncryptedToken}),function(e){return t.attachmentIdToEncryptedToken[e]})},t.prototype.__onDispatch=function(e){switch(e.type){case l.ADD_PENDING_ACTIVITY_KEYS:this.onAddPendingActivityKeys(e);break;case l.REMOVE_PENDING_ACTIVITY_KEYS:this.onRemovePendingActivityKeys(e);break;case l.DELETE_FILES_COMMIT:this.onCommit(e);break;case l.DELETE_FILES_PENDING:this._onDeleteFilesPending(e);break;case l.DELETE_FILES_ROLLBACK:this._onDeleteFilesRollback(e);break;case l.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case l.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case l.RECEIVE_CAN_OPEN_INFO:this.onReceiveCanOpenInfo(e);break;case l.RECEIVE_FILE_IN_ROOT_COLLECTION_INFO:this._onReceiveFileInRootCollectionInfo(e)}},t.prototype.mutateAttachmentInNsIdPath=function(e,t){if(e&&e.indexOf(":")>=0){var n=e.split(":"),i=n[0],r=n[1],o=this.getAll().find(function(e){return e.nsId===Number(i)&&e.nsPath===r})||null;if(o){var a=s.getMutatedOrOriginal(o,t);if(a!==o)return this.attachmentIdToAttachment[o.id]=a,!0}}return!1},t.prototype.updatePendingActivityKeys=function(e,t){var n=this.pendingActivityKeys.length;if(t){var i=(r=this.pendingActivityKeys).concat.apply(r,e);this.pendingActivityKeys=o.uniq(i)}else this.pendingActivityKeys=o.without.apply(o,[this.pendingActivityKeys].concat(e));s.emitChangeIfNeeded(this,n!==this.pendingActivityKeys.length);var r},t.prototype.onAddPendingActivityKeys=function(e){this.updatePendingActivityKeys(e.activityKeys,!0)},t.prototype.onRemovePendingActivityKeys=function(e){this.updatePendingActivityKeys(e.activityKeys,!1)},t.prototype.onReceiveRawRecentActivities=function(e){var t=this,n=e.rawRecentActivities.map(d.createPartialAttachmentsFromRecentActivity),i=(r=[]).concat.apply(r,n).filter(function(e){var n=t.getById(e.id);return!n||!n.isLoaded});i.forEach(function(n){t.attachmentIdToAttachment[n.id]=n,t.attachmentIdToEncryptedToken[n.id]=e.encrypted}),s.emitChangeIfNeeded(this,!!i.length);var r},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;if(e.rawRelatedActivitiesByKey){var n=Object.keys(e.rawRelatedActivitiesByKey);this.updatePendingActivityKeys(n,!1);var a={};s.iterateAndEmitChangesIfNeeded(this,e.rawRelatedActivitiesByKey,function(e,n){try{var i=d.convertFileActivityToAttachmentItem(e);return i.previewInfo&&!i.previewInfo.is_dir&&(a[i.id]=i.previewInfo),t.attachmentIdToAttachment[i.id]=i,!0}catch(e){return o.defer(function(){return c.errorActions.relatedActivityParseError(n,e)}),!1}}),setTimeout(function(){return i.Dispatcher.dispatch({type:r.HomeResourceStoreActionTypes.RECEIVED_RESOURCE_ID_TO_FILE,resourceIdToFile:a})})}},t.prototype.onReceiveCanOpenInfo=function(e){var t=this;s.iterateAndEmitChangesIfNeeded(this,e.canOpenInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{canOpen:e.is_locally_available})})},t.prototype._onReceiveFileInRootCollectionInfo=function(e){var t=this;s.iterateAndEmitChangesIfNeeded(this,e.fileInRootCollectionInfo,function(e,n){return t.mutateAttachmentInNsIdPath(n,{inRootCollection:e})})},t})(a.FluxStore);t.AttachmentStore=p;var h=null;t.getAttachmentStore=_}),define("modules/clean/recent_activity/stores/flux_utils",["require","exports","tslib"],function(e,t,n){"use strict";function i(e,t,n){var i=!1;Object.keys(t).forEach(function(e){n(t[e],e)&&(i=!0)}),r(e,i)}function r(e,t){t&&e.__emitChange()}function o(e,t){for(var i in t)if(t[i]!==e[i])return n.__assign({},e,t);return e}Object.defineProperty(t,"__esModule",{value:!0}),t.iterateAndEmitChangesIfNeeded=i,t.emitChangeIfNeeded=r,t.getMutatedOrOriginal=o}),define("modules/clean/recent_activity/stores/recent_activity_store",["require","exports","tslib","external/lodash","modules/clean/recent_activity/recent_activity_constants","modules/clean/recent_activity/recent_activity_client","modules/clean/recent_activity/models/federated_recent_item","modules/clean/recent_activity/recent_activity_dispatcher","modules/clean/recent_activity/models/recent_item","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/stores/flux_utils","modules/clean/recent_activity/stores/attachment_store","modules/clean/react/home/store","modules/core/exception","modules/clean/recent_activity/recent_activity_stream","modules/clean/react/home/post_tti/api","modules/clean/viewer","modules/clean/react/home/constants","modules/clean/react/home/util/logging/availability_logger","modules/clean/recent_activity/store_utils","modules/clean/flux/flux_store"],function(e,t,n,i,r,o,a,c,s,l,u,d,m,_,p,h,E,f,g,y,v){"use strict";function T(){return null===R&&(R=new I(c.recentActivityDispatcher)),R}Object.defineProperty(t,"__esModule",{value:!0});var I=(function(e){function t(t,n){void 0===n&&(n=[]);var i=e.call(this,t)||this;i.handlePaperRecentsPrefetch=function(){return g.getHomeAvailabilityLogger().handlePrefetch(f.HomePrefetchTypes.RETRIEVE_PAPER_RECENTS,y.handleRetrievePaperRecentsPromise,function(){return o.retrievePaperRecents(m.getUserId(),!0)})},i.removeFileSyncItem=function(e){i.fileSyncRecentItemIdToRecentItem.hasOwnProperty(e.id)&&(delete i.fileSyncRecentItemIdToRecentItem[e.id],i.needsToRefreshFileSyncCache=!0)},i.addFileSyncItem=function(e){e!==i.fileSyncRecentItemIdToRecentItem[e.id]&&(i.fileSyncRecentItemIdToRecentItem[e.id]=e,i.needsToRefreshFileSyncCache=!0)},i.fileSyncRecentItemIdToRecentItem={},i.fileSyncCursor=null,i.fileSyncTransactionIdToRestoreData={},i.didReceiveRawRecentActivities=!!n.length,n.forEach(i.addFileSyncItem),i.fileSyncCache={items:n},i.needsToRefreshFileSyncCache=!1;var a=m.getHomeStore().getSectionLoadingPreference(f.ConditionalSections.PAPER_RECENTS)===f.ConditionalSectionLoadingPreference.POST_TTI;return i.paperStream=a?new p.RecentActivityStream([],!1):null,i.didRecievePaperItems=a,i.paperActivityKeyToPendingArchiving={},i.cachedFederatedRecentItems=[],i.cachedFederatedTruncatedRecentItems=[],i.federatedRecentItemsCountMax=r.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_PRE_TTI,h.waitForHomeTTI().then(function(){i.federatedRecentItemsCountMax=r.MAX_RECENT_ITEM_COUNT_ON_RECENTS_V2_POST_TTI,i.didTruncateRecentItems()&&i.cacheTruncatedFederatedRecentItems()}),d.getAttachmentStore(),g.getHomeAvailabilityLogger().handlePrefetch(f.HomePrefetchTypes.RECENTS_JSON,y.handleAndLogRecentsJsonPromise,function(){return o.recentsJson(m.getUserId())}),a?h.waitForHomeTTI().then(i.handlePaperRecentsPrefetch):i.handlePaperRecentsPrefetch(),i}return n.__extends(t,e),t.prototype.getSortedFileSyncRecentItems=function(){return this.fileSyncCache.sortedItems||(this.fileSyncCache.sortedItems=this.fileSyncCache.items.slice().sort(l.compareRecentItems)),this.fileSyncCache.sortedItems},t.prototype.__onDispatch=function(e){this.fileSyncHandler(e)||this.paperHandler(e)},t.prototype.fileSyncHandler=function(e){switch(e.type){case r.DELETE_FILES_COMMIT:this.onDeleteCommit(e);break;case r.DELETE_FILES_PENDING:this.onDeleteFilesPending(e);break;case r.DELETE_FILES_ROLLBACK:this.onDeleteFilesRollback(e);break;case r.RECEIVE_RAW_RECENT_ACTIVITIES:this.onReceiveRawRecentActivities(e);break;case r.RECEIVE_RAW_RELATED_ACTIVITIES_BY_KEY:this.onReceiveRawRelatedActivitiesByKey(e);break;case r.RAW_RELATED_ACTIVITY_PARSE_ERROR:this.onRawRelatedActivityParseError(e);break;case r.REFRESH_RECENT_ACTIVITIES:this.onRefreshRecentActivities();break;default:return!1}return this.updateFileSyncCache(!0),!0},t.prototype.paperHandler=function(e){switch(e.type){case r.RECEIVE_PAPER_RECENT_ITEMS:this.onReceivePaperRecentItems(e.items,e.hasMore,e.userId);break;case r.ARCHIVE_PAPER_DOCUMENT_PENDING:this.onArchivePaperDocumentPending(e.activityKey);break;case r.ARCHIVE_PAPER_DOCUMENT_COMMIT:this.onArchivePaperDocumentCommit(e.activityKey);break;case r.ARCHIVE_PAPER_DOCUMENT_ROLLBACK:this.onArchivePaperDocumentRollback(e.activityKey);break;default:return}this.__emitChange()},t.prototype.updateFileSyncCache=function(e){this.needsToRefreshFileSyncCache&&(this.fileSyncCache={items:i.values(this.fileSyncRecentItemIdToRecentItem)},this.clearFederatedCache(),this.needsToRefreshFileSyncCache=!1,u.emitChangeIfNeeded(this,e))},t.prototype.onDeleteCommit=function(e){
delete this.fileSyncTransactionIdToRestoreData[e.transactionId]},t.prototype.onReceiveRawRecentActivities=function(e){var t=this;u.emitChangeIfNeeded(this,!this.didReceiveRawRecentActivities&&!e.rawRecentActivities.length),this.didReceiveRawRecentActivities=!0;var n=!this.fileSyncCache.items.length,o=[],a={};if(e.rawRecentActivities.forEach(function(c){if(c.viewing_user&&c.viewing_user.id===e.userId){var l=s.convertRecentActivityToRecentItem(c);if(l&&(l.uniqueFilterTypes.indexOf(r.RECENT_EVENT_FILTER_TYPE.JUNK)<0||l.uniqueFilterTypes.indexOf(r.RECENT_EVENT_FILTER_TYPE.ALL)>=0))if(o.push(c),n)t.fileSyncRecentItemIdToRecentItem[l.id]=l;else if(!a[l.id]){a[l.id]=l;var u=t.fileSyncCache.items.find(function(e){return e.id!==l.id&&e.contextDisplayName===l.contextDisplayName});if(u){var d=i.intersection(u.attachmentIds,l.attachmentIds);d.length>0&&(t.removeFileSyncItem(u),t.updateFileSyncCache(!1))}var m=t.fileSyncRecentItemIdToRecentItem[l.id];t.updateFileSyncItem(l,{fqPath:m&&m.fqPath||void 0,paths:m&&m.paths||l.paths})}}}),h.waitForHomeTTI().then(function(e){return e.fetchStarredStatus(o)}),this.updateFileSyncCache(!1),!n){var c={};this.getSortedFileSyncRecentItems().forEach(function(e){if(e.attachmentIds.length>0){var n=Object.keys(c).length;e.attachmentIds.forEach(function(e){return c[e]=!0}),n===Object.keys(c).length&&t.removeFileSyncItem(e)}})}this.fileSyncCursor=e.cursor,this.needsToRefreshFileSyncCache=!0},t.prototype.onReceiveRawRelatedActivitiesByKey=function(e){var t=this;this.waitForAttachmentStoreDispatcher();var n=Object.keys(e.rawRelatedActivitiesByKey||{});n.length&&this.clearFederatedCache(),this.getFileSyncRecentItemsByAttachmentIds(n).forEach(function(e){var n=e.id,i=t.fileSyncRecentItemIdToRecentItem[n];if(i){var r=i.attachmentIds;if(r&&r.length){var o=d.getAttachmentStore().getById(r[0]);if(o&&o.isLoaded){var a=o.fqPath||"";r.slice(1).forEach(function(e){var t=d.getAttachmentStore().getById(e);if(t.isLoaded){var n=t.fqPath||"";n.split("/").length<a.split("/").length&&(a=n)}});var c=a.split("/"),s=c[c.length-2];t.updateFileSyncItem(i,{fqPath:a,paths:l.getPathsByFqPath(a,i.viewingUserId),contextDisplayName:s||i.contextDisplayName})}}}})},t.prototype.onRawRelatedActivityParseError=function(e){this.getFileSyncRecentItemsByAttachmentIds(i.map(e.errors,"activityKey")).forEach(this.removeFileSyncItem)},t.prototype.onDeleteFilesPending=function(e){this.waitForAttachmentStoreDispatcher();var t=this.deleteAttachments(e.attachmentIds);t&&(this.fileSyncTransactionIdToRestoreData[e.transactionId]=t)},t.prototype.onDeleteFilesRollback=function(e){this.waitForAttachmentStoreDispatcher();var t=this.fileSyncTransactionIdToRestoreData[e.transactionId];_.assert(!!t,"Unable to find data for transaction with id: "+e.transactionId),delete this.fileSyncTransactionIdToRestoreData[e.transactionId],this.rollbackDelete(t)},t.prototype.onRefreshRecentActivities=function(){this.getRecentItems(),this.didReceiveRawRecentActivities=!1,this.didRecievePaperItems=!1},t.prototype.deleteAttachments=function(e){var t=null;if(e.length){var n=this.getFileSyncRecentItemsByAttachmentIds([e[0]])[0];if(n){var r=i.difference(n.attachmentIds,e);this.updateFileSyncItem(n,{attachmentIds:r}),t={deletedAttachmentIds:e,item:n},0===r.length&&this.removeFileSyncItem(n)}}return t},t.prototype.rollbackDelete=function(e){var t,n=this.fileSyncRecentItemIdToRecentItem[e.item.id];n?t=n.attachmentIds:(n=e.item,t=[]),this.updateFileSyncItem(n,{attachmentIds:i.uniq(t.concat.apply(t,e.deletedAttachmentIds))})},t.prototype.getCachedAttachmentIdToIdToFileSyncItem=function(){var e=this;return this.fileSyncCache.attachmentIdToIdToItem||(this.fileSyncCache.attachmentIdToIdToItem={},this.fileSyncCache.items.forEach(function(t){return t.attachmentIds.forEach(function(n){e.fileSyncCache.attachmentIdToIdToItem[n]?e.fileSyncCache.attachmentIdToIdToItem[n][t.id]=t:e.fileSyncCache.attachmentIdToIdToItem[n]=(i={},i[t.id]=t,i);var i})})),this.fileSyncCache.attachmentIdToIdToItem},t.prototype.getFileSyncRecentItemsByAttachmentIds=function(e){var t=this.getCachedAttachmentIdToIdToFileSyncItem(),n={};return e.forEach(function(e){t.hasOwnProperty(e)&&i.values(t[e]).forEach(function(e){return n[e.id]=e})}),i.values(n)},t.prototype.waitForAttachmentStoreDispatcher=function(){this.getDispatcher().waitFor([d.getAttachmentStore().getDispatchToken()])},t.prototype.updateFileSyncItem=function(e,t){this.addFileSyncItem(u.getMutatedOrOriginal(e,t))},t.prototype.onArchivePaperDocumentPending=function(e){this.paperActivityKeyToPendingArchiving[e]=!0},t.prototype.onArchivePaperDocumentCommit=function(e){this.deletePendingArchive(e),this.paperStream=this.paperStream.getStreamWithoutActivityKey(e),this.clearFederatedCache()},t.prototype.onArchivePaperDocumentRollback=function(e){this.deletePendingArchive(e)},t.prototype.deletePendingArchive=function(e){this.paperActivityKeyToPendingArchiving[e]&&delete this.paperActivityKeyToPendingArchiving[e]},t.prototype.onReceivePaperRecentItems=function(e,t,n){this.didRecievePaperItems=!0;var i=E.Viewer.get_viewer().get_user_by_id(n),r=e.map(function(e,t){return a.createRecentItemFromPaperRecentItem(e,i,t)});this.paperStream=new p.RecentActivityStream(r,t),h.waitForHomeTTI().then(function(t){return t.setStarredStatusOfPaperRecentItems(e)}),this.clearFederatedCache()},t.prototype.clearFederatedCache=function(){this.cachedFederatedRecentItems&&this.didReceiveItemsFromAllStreams()&&(this.__emitChange(),this.cachedFederatedRecentItems=null,this.cachedFederatedTruncatedRecentItems=null)},t.prototype.cacheTruncatedFederatedRecentItems=function(){this.cachedFederatedRecentItems?this.cachedFederatedTruncatedRecentItems=this.cachedFederatedRecentItems.slice(0,this.federatedRecentItemsCountMax):this.getRecentItems()},t.prototype.getFileSyncCursor=function(){return this.fileSyncCursor},t.prototype.canArchiveActivityKey=function(e){if(this.paperStream&&!this.paperActivityKeyToPendingArchiving[e]){var t=this.paperStream.getRecentItemByActivityKey(e);return!(!t||!t.federatedRecentItem.isArchiveable())}return!1},t.prototype.didReceiveItemsFromAllStreams=function(){return this.didRecievePaperItems&&this.didReceiveRawRecentActivities},t.prototype.getRecentItems=function(){if(null===this.cachedFederatedRecentItems){var e=[this.paperStream,new p.RecentActivityStream(this.getSortedFileSyncRecentItems(),!!this.fileSyncCursor)];this.cachedFederatedRecentItems=p.getMergedRecentItems(e),this.cacheTruncatedFederatedRecentItems()}return this.cachedFederatedTruncatedRecentItems},t.prototype.didTruncateRecentItems=function(){return!!(this.cachedFederatedRecentItems&&this.cachedFederatedTruncatedRecentItems&&this.cachedFederatedTruncatedRecentItems.length<this.cachedFederatedRecentItems.length)},t})(v.FluxStore);t.RecentActivityStore=I;var R=null;t.getRecentActivityStore=T}),define("modules/clean/recent_activity/versions/recent_activity_actions_menu_version_2",["require","exports","external/classnames","external/spectrum/overflow_button","external/react","modules/core/i18n","external/spectrum/popover"],function(e,t,n,i,r,o,a){"use strict";function c(e,t,n){return r.createElement(a.PopoverContentItem,{className:"recents-actions-list__item recents-actions-list__item--"+e,key:e,value:n},t)}function s(e){var t=e.props.permissions;return[e.canOpen()?c("open",o._("Open"),e.onOpen):null,t.share?c("share-link",o._("Share link"),e.onShareLink):null,t.download?c("download",o._("Download"),e.onDownload):null,t.comment?c("comment",o._("Comment"),e.onComment):null,t.delete?c("delete",e.getDeleteLabel(),e.onDelete):null,t.archive?c("archive",o._("Archive"),e.onArchive):null,t.versions?c("versions",o._("Version history"),e.onVersions):null].filter(Boolean)}function l(e,t){e(t)}function u(e){var t=n({"recents-item__actions-button":!0,"button-secondary":!0,disabled:e.props.disableActions});return r.createElement(i.OverflowButton,{tagName:"span",className:t,"aria-label":o._("More Actions"),tabIndex:0})}function d(e){return e.props.disableActions?u(e):r.createElement("div",{onClick:m,onDoubleClick:m},r.createElement(a.Popover,{onSelection:l,closeOnSelection:!0},r.createElement(a.PopoverTrigger,null,u(e)),r.createElement(a.PopoverContent,{attachment:"right"},s(e))))}Object.defineProperty(t,"__esModule",{value:!0});var m=function(e){return e.stopPropagation()};t.renderMoreActionsButton=d}),define("modules/clean/recent_activity/versions/recent_activity_version_2",["require","exports","tslib","modules/clean/recent_activity/actions/federated_recent_activity_actions","modules/clean/recent_activity/actions/recent_activity_actions","modules/clean/recent_activity/recent_activity_logger","modules/clean/recent_activity/models/utils","modules/clean/recent_activity/recent_activity_logger_utils","modules/core/exception","modules/clean/recent_activity/recent_activity_constants","modules/clean/react/home/constants","modules/clean/react/home/util/navigation","modules/clean/react/home/post_tti/api"],function(e,t,n,i,r,o,a,c,s,l,u,d,m){"use strict";function _(e){return{shouldFocusCommentInput:e.shouldFocusCommentInput,index:e.index,shouldUseEntityUri:e.shouldUseEntityUri}}Object.defineProperty(t,"__esModule",{value:!0});var p=(function(){function e(){}return e.prototype.shareRecentItem=function(e,t,n,o){e.federatedRecentItem?i.shareItem(e.federatedRecentItem,n):r.shareFile(t[0].id,n,o)},e.prototype.previewRecentItem=function(e,t,r){return n.__awaiter(this,void 0,void 0,function(){var o;return n.__generator(this,function(n){switch(n.label){case 0:return e.federatedRecentItem?(i.previewItem(e.federatedRecentItem,r),[3,4]):[3,1];case 1:return 1!==e.attachmentIds.length?[3,3]:(o=d.isMetaKeyPressed(t.event),[4,m.waitForHomeTTI()]);case 2:return n.sent().previewFileSyncRecentItem(e,o,t,r),[3,4];case 3:s.reportStack("To preview, file sync items must have 1 attachment id",{severity:s.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e,previewOptions:_(t)}}),n.label=4;case 4:return[2]}})})},e.prototype.deleteRecentItem=function(e,t,n){if(e.federatedRecentItem)s.reportStack("Deleting is not supported for federated recent items",{severity:s.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e}});else{var i=e.displayType===u.DisplayTypes.SHARED_FOLDER;r.promptAndDeleteAttachments(a.extractAttachmentIds(t),i,n)}},e.prototype.archiveRecentItem=function(e,t){e.federatedRecentItem?i.promptAndArchiveItem(e.federatedRecentItem,e.viewingUserId,t):s.reportStack("Archiving is not supported",{severity:s.SEVERITY.NONCRITICAL,exc_extra:{recentItem:e}})},e.prototype.handlePathClick=function(e,t,n){e.preventDefault(),e.stopPropagation(),c.openTab(e.currentTarget.href,o.ActionTypes.OPEN_PATH,t.attachmentIds,n)},e.prototype.getShareButtonVisibility=function(e,t){return e.federatedRecentItem?e.federatedRecentItem.isShareable()?l.RecentElementVisibilities.SHOWN:l.RecentElementVisibilities.HIDDEN:t?l.RecentElementVisibilities.SHOWN:l.RecentElementVisibilities.HIDDEN},e})();t.RecentActivityVersion2=new p});
//# sourceMappingURL=pkg-home.min.js-vflJy4ijK.map