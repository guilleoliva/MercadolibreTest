define(["require","exports","tslib","external/react","modules/clean/video_annotations_prototype/components/time_button","modules/clean/video_annotations_prototype/video_annotation_prototype_helper","modules/clean/avatar/photo_avatar","modules/clean/avatar/viewer_avatar","modules/clean/datetime","modules/clean/video_annotations_prototype/components/avatar","modules/clean/video_annotations_prototype/components/base_comment_input","modules/clean/video_annotations_prototype/components/notify_hint","modules/core/i18n","external/lodash","modules/clean/video_annotations_prototype/components/deleted_top_comment","external/react-dom"],function(e,t,n,o,a,l,r,m,s,i,c,d,p,u,h,_){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleDeleteClick=function(){var e=t.props,n=e.comment;(0,e.deleteComment)(n)},t}return n.__extends(t,e),t.prototype.render=function(){var e=this.props,t=e.collapsed,n=e.comment,c=e.deleteComment,d=e.user,p=e.videoLength,u=n.comment_text,h=n.comment_metadata.frame_time,_=n.commenter_info,f=_.dbx_account_id,v=_.display_name,y=_.photo_circle_url,E=n.when_created,C=n.is_deleted,N=n.permissions.can_delete;if(C)return null;var g=N&&c,T=o.createElement(i.InitialsAvatar,{displayName:v});d&&f===d.account_id?T=o.createElement(m,{photoUrl:d.photo_circle_url,alt:v,dimension:24,defaultAvatar:T}):y&&(T=o.createElement(r.PhotoAvatar,{photoUrl:y,alt:v,dimension:24}));var b="reply_count"in n,x=b&&h!==-1&&o.createElement(a.TimeButton,{time:l.VideoAnnotationPrototypeHelper.unitConvertDomainObjectTimeToSeconds(h),videoLength:p});return o.createElement("div",{className:"single-comment-holder"},o.createElement("div",{className:"commenter-photo"},T),o.createElement("div",{className:"comment"},!t&&o.createElement("div",null,o.createElement("span",{className:"commenter-name"},v),o.createElement("span",{className:"comment-spacer"}),o.createElement("span",{className:"comment-when"},s.ago(E,!1,!0,!0)),g&&o.createElement("span",{className:"comment-dot"}," Â· "),g&&o.createElement("button",{className:"delete-button button-as-link",onClick:this.handleDeleteClick},"Delete")),o.createElement("div",{className:"comment-body"},x,u)))},t})(o.Component),v=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state={replyText:""},t.handleClick=function(){var e=t.props,n=e.collapsed,o=e.onExpand;o&&n&&o()},t.handleReplyChange=function(e){t.setState({replyText:e})},t.handleReplySubmit=function(){var e=t.props,n=e.user,o=e.replyToComment,a=t.state.replyText;n&&o&&o({comment_text:a,comment_metadata:{frame_time:-1}})},t}return n.__extends(t,e),t.prototype.componentDidUpdate=function(e,n){if(e.collapsed&&!this.props.collapsed){var o=_.findDOMNode(this),a=o.parentElement,l=a.scrollTop;o.offsetParent!==a&&(l+=a.offsetTop),l>o.offsetTop&&(a.scrollTop-=l-o.offsetTop,l=o.offsetTop);var r=l+a.clientHeight,m=o.offsetTop+o.clientHeight,s=m-r;s>0&&(a.scrollTop+=s+t.ADDITIONAL_SCROLL_MARGIN)}},t.prototype.renderCollapsed=function(){var e=this.props,t=e.comment,n=e.deleteComment,a=e.user,l=e.videoLength,r=t.is_deleted,m=t.reply_comments,s=u.filter(m,function(e){return!e.is_deleted}),i=u.last(s),c=s.length-1;return o.createElement("div",{className:"comment-thread-with-hint"},o.createElement("div",{className:"comment-thread collapsed",onClick:this.handleClick},r?o.createElement(h.DeletedTopComment,{comment:t,videoLength:l}):o.createElement(f,{comment:t,deleteComment:n,user:a,videoLength:l,collapsed:!0}),c>0&&o.createElement("div",{className:"hidden-replies"},o.createElement("a",{className:"replies-count-button"},p.ungettext("%(num)s more reply","%(num)s more replies",c).format({num:c}))),i&&o.createElement(f,{key:i.comment_gid,comment:i,deleteComment:n,user:a,videoLength:l,collapsed:!0})))},t.prototype.getFooterInfo=function(){var e=this.props,t=e.user,n=e.comment,o=n.is_deleted,a=n.repliers_to_notify,l=e.ownersToNotify,r=t&&!o,m=u.uniqBy(a.concat(l),function(e){return e.dbx_account_id});return{enableReplyFooter:r,shouldShowNotifyHint:r&&m.length>0,usersToNotify:m}},t.prototype.render=function(){var e=this.props,t=e.collapsed,n=e.comment,a=e.deleteComment,l=e.user,r=e.videoLength,m=n.comment_gid,s=n.is_deleted,i=n.is_resolved,p=n.reply_comments,u=p.filter(function(e){return!e.is_deleted}).length;if(i||s&&0===u)return null;if(t)return this.renderCollapsed();var _=this.getFooterInfo(),v=_.enableReplyFooter,y=_.shouldShowNotifyHint,E=_.usersToNotify,C=this.state.replyText;return o.createElement("div",{className:"comment-thread-with-hint"},o.createElement("div",{className:"comment-thread"},o.createElement("div",null,s?o.createElement(h.DeletedTopComment,{comment:n,videoLength:r}):o.createElement(f,{key:m,comment:n,deleteComment:a,user:l,videoLength:r,collapsed:!1}),p.map(function(e){return o.createElement(f,{key:e.comment_gid,comment:e,deleteComment:a,user:l,videoLength:r,collapsed:!1})})),v&&o.createElement("div",{className:"comment-thread__reply-footer"},o.createElement(c.BaseCommentInput,{onChange:this.handleReplyChange,onSubmit:this.handleReplySubmit,placeholderText:"Reply...",user:l,text:C}))),y&&o.createElement(d.NotifyHint,{usersToNotify:E}))},t.ADDITIONAL_SCROLL_MARGIN=25,t})(o.Component);t.VideoCommentSubthread=v});
//# sourceMappingURL=video_comment.min.js-vfl8b7N1q.map