define(["require","exports","tslib","external/react","modules/clean/previews/util","external/spectrum/popover","modules/clean/react/file_action_button_type","modules/clean/react/file_viewer/actions","modules/clean/react/file_viewer/constants","modules/clean/react/file_viewer/utils","modules/clean/react/file_viewer/more_dropdown/more_option_registry","modules/clean/react/file_viewer/more_dropdown/views","modules/clean/react/size_class/constants","modules/clean/react/title_bar/overflow_menu","modules/core/browser","modules/core/i18n","modules/clean/react/paper/paper_new_badge","modules/clean/react/paper/utils"],function(e,t,o,r,n,i,s,l,a,p,c,u,m,d,h,v,_,g){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var f=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.state=t.getStateFromRegistry(),t.onRegistryUpdate=function(){t.setState(t.getStateFromRegistry())},t.handleDownloadClick=function(e){return e.preventDefault(),l.download(t.props.file),l.logUserAction(a.UserAction.Download,a.UserActionContext.TitleBarMore)},t.handleRemoveLinkClick=function(e){e.preventDefault(),t.props.onRemoveShareLink&&(t.props.onRemoveShareLink(),l.logUserAction(a.UserAction.RemoveLink,a.UserActionContext.TitleBarMore))},t.handlePreviousVersionClick=function(e){if(e.preventDefault(),!t.props.user)throw new Error("User not specified");return n.redirectToVersionHistory(t.props.file,t.props.user),l.logUserAction(a.UserAction.ViewRevisions,a.UserActionContext.TitleBarMore)},t.handleSignInClick=function(e){e.preventDefault(),l.logUserAction(a.UserAction.SignIn,a.UserActionContext.TitleBarMore),h.redirect(p.getSharedLinkLoginUrl())},t.handleOpenInPaperClick=function(e){e.preventDefault();var o={file:t.props.file,user:t.props.user,sharedLink:t.props.sharedLink};g.openFileInPaper(o)},t}return o.__extends(t,e),t.prototype.componentDidMount=function(){this.removeRegistryListener=c.moreOptionRegistry.addListener(this.onRegistryUpdate)},t.prototype.componentWillUnmount=function(){this.removeRegistryListener()},t.prototype.getStateFromRegistry=function(){return{registeredItems:c.moreOptionRegistry.getOptionItems()}},t.prototype.getPopoverContent=function(){var e=this.props,t=e.allowRemoveLink,o=e.isPrivate,n=e.onRemoveShareLink,l=e.renderSignIn,a=e.shareDownloadOptions,p=e.sizeClass,c=e.showOpenInPaper,h=[],f=p===m.SizeClass.Small,k=p===m.SizeClass.Medium,S=p===m.SizeClass.Large;if(o&&k&&h.push(r.createElement(d.PopoverOrMobileItem,{className:"more-button__share",key:"more-button__share",onSelect:this.props.onClickShareLink},s.getFileActionButtonText(s.FileActionButtonType.SHARE))),null!=n&&t&&!f&&h.push(r.createElement(d.PopoverOrMobileItem,{className:"more-button__remove",key:"more-button__remove",onSelect:this.handleRemoveLinkClick},s.getFileActionButtonText(s.FileActionButtonType.REMOVE_LINK))),o&&h.push(r.createElement(d.PopoverOrMobileItem,{className:"more-button__download",key:"more-button__download",onSelect:this.handleDownloadClick},s.getFileActionButtonText(s.FileActionButtonType.DOWNLOAD))),a)for(var b=0,C=a;b<C.length;b++){var w=C[b];if(!w.isDisabled){var A="more-button-sl__"+w.userAction;h.push(r.createElement(y,{handler:w.handler,key:A,text:w.text,userAction:w.userAction}))}}if(o&&!f&&h.push(r.createElement(d.PopoverOrMobileItem,{className:"more-button__version-history",key:"more-button__version-history",onSelect:this.handlePreviousVersionClick},s.getFileActionButtonText(s.FileActionButtonType.PREVIOUS_VERSIONS))),S&&h.length&&this.state.registeredItems.length&&h.push(r.createElement(i.PopoverContentSeparator,{key:"more_button__seperator"})),S){var I=u.getPopoverOrMobileItemsForMoreOptions(this.state.registeredItems);h=h.concat(I)}return l&&h.push(r.createElement(d.PopoverOrMobileItem,{className:"more-button__sign-in",key:"more-button__sign-in",onSelect:this.handleSignInClick},v._("Sign in"))),c&&(S&&h.length&&this.state.registeredItems.length&&h.push(r.createElement(i.PopoverContentSeparator,{key:"more_button__separator2"})),h.push(r.createElement(d.PopoverOrMobileItem,{className:"more-button__open-in-paper",key:"more-button__open-in-paper",onSelect:this.handleOpenInPaperClick},g.getCTAText(this.props.file),r.createElement(_.PaperNewBadge,null)))),h},t.prototype.render=function(){return r.createElement(d.OverflowMenu,{contentWrapperClassName:"react-file-viewer-dropdown"},this.getPopoverContent())},t})(r.Component);t.MoreDropdown=f;var y=(function(e){function t(){var t=null!==e&&e.apply(this,arguments)||this;return t.handleClick=function(){var e=t.props,o=e.handler,r=e.userAction;l.logUserAction(r,a.UserActionContext.TitleBarMore),o()},t}return o.__extends(t,e),t.prototype.render=function(){var e=this.props.text;return r.createElement(d.PopoverOrMobileItem,{onSelect:this.handleClick},e)},t})(r.PureComponent)});
//# sourceMappingURL=more_dropdown.min.js-vflXHjvbA.map